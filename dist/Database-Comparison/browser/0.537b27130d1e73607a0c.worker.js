!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,(function(e){return t[e]}).bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="RU5d")}({RU5d:function(t,e,n){"use strict";function r(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(e){o(e)}}function a(t){try{u(r.throw(t))}catch(e){o(e)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}u((r=r.apply(t,e||[])).next())})}let i,o;n.r(e);const s=new WeakMap,a=new WeakMap,u=new WeakMap,l=new WeakMap,c=new WeakMap;let h={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return a.get(t);if("objectStoreNames"===e)return t.objectStoreNames||u.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function f(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{e(f(t.result)),r()},o=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(e=>{e instanceof IDBCursor&&s.set(e,t)}).catch(()=>{}),c.set(e,t),e}(t);if(l.has(t))return l.get(t);const e=function(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(d(this),t),f(s.get(this))}:function(...t){return f(e.apply(d(this),t))}:function(t,...n){const r=e.call(d(this),t,...n);return u.set(r,t.sort?t.sort():[t]),f(r)}:(t instanceof IDBTransaction&&function(t){if(a.has(t))return;const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{e(),r()},o=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});a.set(t,e)}(t),n=t,(i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>n instanceof t)?new Proxy(t,h):t);var e,n}(t);return e!==t&&(l.set(t,e),c.set(e,t)),e}const d=t=>c.get(t),p=["get","getKey","getAll","getAllKeys","count"],y=["put","add","delete","clear"],v=new Map;function m(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(v.get(e))return v.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=y.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!p.includes(n))return;const o=async function(t,...e){const o=this.transaction(t,i?"readwrite":"readonly");let s=o.store;return r&&(s=s.index(e.shift())),(await Promise.all([s[n](...e),i&&o.done]))[0]};return v.set(e,o),o}var g;g=h,h={...g,get:(t,e,n)=>m(t,e)||g.get(t,e,n),has:(t,e)=>!!m(t,e)||g.has(t,e)};var b=function(){return(b=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function w(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var I=Object.keys,x=Array.isArray,k="undefined"!=typeof self?self:"undefined"!=typeof window?window:global;function O(t,e){return"object"!=typeof e||I(e).forEach(function(n){t[n]=e[n]}),t}"undefined"==typeof Promise||k.Promise||(k.Promise=Promise);var _=Object.getPrototypeOf,P={}.hasOwnProperty;function S(t,e){return P.call(t,e)}function D(t,e){"function"==typeof e&&(e=e(_(t))),I(e).forEach(function(n){C(t,n,e[n])})}var A=Object.defineProperty;function C(t,e,n,r){A(t,e,O(n&&S(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function j(t){return{from:function(e){return t.prototype=Object.create(e.prototype),C(t.prototype,"constructor",t),{extend:D.bind(null,t.prototype)}}}}var E=Object.getOwnPropertyDescriptor;function F(t,e){var n;return E(t,e)||(n=_(t))&&F(n,e)}var M=[].slice;function B(t,e,n){return M.call(t,e,n)}function q(t,e){return e(t)}function N(t){if(!t)throw new Error("Assertion Failed")}function K(t){k.setImmediate?setImmediate(t):setTimeout(t,0)}function T(t,e){return t.reduce(function(t,n,r){var i=e(n,r);return i&&(t[i[0]]=i[1]),t},{})}function R(t,e){if(S(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var n=[],r=0,i=e.length;r<i;++r){var o=R(t,e[r]);n.push(o)}return n}var s=e.indexOf(".");if(-1!==s){var a=t[e.substr(0,s)];return void 0===a?void 0:R(a,e.substr(s+1))}}function z(t,e,n){if(t&&void 0!==e&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){N("string"!=typeof n&&"length"in n);for(var r=0,i=e.length;r<i;++r)z(t,e[r],n[r])}else{var o=e.indexOf(".");if(-1!==o){var s=e.substr(0,o),a=e.substr(o+1);if(""===a)void 0===n?x(t)&&!isNaN(parseInt(s))?t.splice(s,1):delete t[s]:t[s]=n;else{var u=t[s];u||(u=t[s]={}),z(u,a,n)}}else void 0===n?x(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function $(t,e){"string"==typeof e?z(t,e,void 0):"length"in e&&[].map.call(e,function(e){z(t,e,void 0)})}function L(t){var e={};for(var n in t)S(t,n)&&(e[n]=t[n]);return e}var V=[].concat;function W(t){return V.apply([],t)}var U="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(W([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return k[t]}),J=U.map(function(t){return k[t]}),H=T(U,function(t){return[t,!0]});function Y(t){if(!t||"object"!=typeof t)return t;var e;if(x(t)){e=[];for(var n=0,r=t.length;n<r;++n)e.push(Y(t[n]))}else if(J.indexOf(t.constructor)>=0)e=t;else for(var i in e=t.constructor?Object.create(t.constructor.prototype):{},t)S(t,i)&&(e[i]=Y(t[i]));return e}var G={}.toString;function Q(t){return G.call(t).slice(8,-1)}var X=function(t,e){return"Array"===e?""+t.map(function(t){return X(t,Q(t))}):"ArrayBuffer"===e?""+new Uint8Array(t):"Date"===e?t.getTime():ArrayBuffer.isView(t)?""+new Uint8Array(t.buffer):t};function Z(t,e,n,r){return n=n||{},r=r||"",I(t).forEach(function(i){if(S(e,i)){var o=t[i],s=e[i];if("object"==typeof o&&"object"==typeof s&&o&&s){var a=Q(o),u=Q(s);a===u?H[a]?X(o,a)!==X(s,u)&&(n[r+i]=e[i]):Z(o,s,n,r+i+"."):n[r+i]=e[i]}else o!==s&&(n[r+i]=e[i])}else n[r+i]=void 0}),I(e).forEach(function(i){S(t,i)||(n[r+i]=e[i])}),n}var tt="undefined"!=typeof Symbol&&Symbol.iterator,et=tt?function(t){var e;return null!=t&&(e=t[tt])&&e.apply(t)}:function(){return null},nt={};function rt(t){var e,n,r,i;if(1===arguments.length){if(x(t))return t.slice();if(this===nt&&"string"==typeof t)return[t];if(i=et(t)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==t)return[t];if("number"==typeof(e=t.length)){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var it="undefined"!=typeof Symbol?function(t){return"AsyncFunction"===t[Symbol.toStringTag]}:function(){return!1},ot="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function st(t,e){ot=t,at=e}var at=function(){return!0},ut=!new Error("").stack;function lt(){if(ut)try{throw new Error}catch(t){return t}return new Error}function ct(t,e){var n=t.stack;return n?(e=e||0,0===n.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),n.split("\n").slice(e).filter(at).map(function(t){return"\n"+t}).join("")):""}var ht=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ft=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ht),dt={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function pt(t,e){this._e=lt(),this.name=t,this.message=e}function yt(t,e){return t+". Errors: "+Object.keys(e).map(function(t){return e[t].toString()}).filter(function(t,e,n){return n.indexOf(t)===e}).join("\n")}function vt(t,e,n,r){this._e=lt(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=yt(t,e)}function mt(t,e){this._e=lt(),this.name="BulkError",this.failures=e,this.message=yt(t,e)}j(pt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+ct(this._e,2))}},toString:function(){return this.name+": "+this.message}}),j(vt).from(pt),j(mt).from(pt);var gt=ft.reduce(function(t,e){return t[e]=e+"Error",t},{}),bt=pt,wt=ft.reduce(function(t,e){var n=e+"Error";function r(t,r){this._e=lt(),this.name=n,t?"string"==typeof t?(this.message=t+(r?"\n "+r:""),this.inner=r||null):"object"==typeof t&&(this.message=t.name+" "+t.message,this.inner=t):(this.message=dt[e]||n,this.inner=null)}return j(r).from(bt),t[e]=r,t},{});wt.Syntax=SyntaxError,wt.Type=TypeError,wt.Range=RangeError;var It=ht.reduce(function(t,e){return t[e+"Error"]=wt[e],t},{}),xt=ft.reduce(function(t,e){return-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=wt[e]),t},{});function kt(){}function Ot(t){return t}function _t(t,e){return null==t||t===Ot?e:function(n){return e(t(n))}}function Pt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function St(t,e){return t===kt?e:function(){var n=t.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Pt(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Pt(i,this.onerror):i),void 0!==o?o:n}}function Dt(t,e){return t===kt?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Pt(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Pt(r,this.onerror):r)}}function At(t,e){return t===kt?e:function(n){var r=t.apply(this,arguments);O(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Pt(i,this.onsuccess):i),o&&(this.onerror=this.onerror?Pt(o,this.onerror):o),void 0===r?void 0===s?void 0:s:O(r,s)}}function Ct(t,e){return t===kt?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function jt(t,e){return t===kt?e:function(){var n=t.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return e.apply(r,o)})}return e.apply(this,arguments)}}xt.ModifyError=vt,xt.DexieError=pt,xt.BulkError=mt;var Et={},Ft="undefined"==typeof Promise?[]:function(){var t=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[t,t.__proto__,t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,e.__proto__,t]}(),Mt=Ft[0],Bt=Ft[1],qt=Ft[2],Nt=Bt&&Bt.then,Kt=Mt&&Mt.constructor,Tt=!!qt,Rt=!1,zt=qt?function(){qt.then(ce)}:k.setImmediate?setImmediate.bind(null,ce):k.MutationObserver?function(){var t=document.createElement("div");new MutationObserver(function(){ce(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(ce,0)},$t=function(t,e){Qt.push([t,e]),Vt&&(zt(),Vt=!1)},Lt=!0,Vt=!0,Wt=[],Ut=[],Jt=null,Ht=Ot,Yt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Be,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(t){try{Be(t[0],t[1])}catch(e){}})}},Gt=Yt,Qt=[],Xt=0,Zt=[];function te(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=kt,this._lib=!1;var e=this._PSD=Gt;if(ot&&(this._stackHolder=lt(),this._prev=null,this._numPrev=0),"function"!=typeof t){if(t!==Et)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&ie(this,this._value))}this._state=null,this._value=null,++e.ref,re(this,t)}var ee={get:function(){var t=Gt,e=we;function n(n,r){var i=this,o=!t.global&&(t!==Gt||e!==we),s=o&&!Oe(),a=new te(function(e,a){se(i,new ne(Ee(n,t,o,s),Ee(r,t,o,s),e,a,t))});return ot&&le(a,this),a}return n.prototype=Et,n},set:function(t){C(this,"then",t&&t.prototype===Et?ee:{get:function(){return t},set:ee.set})}};function ne(t,e,n,r,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=r,this.psd=i}function re(t,e){try{e(function(e){if(null===t._state){if(e===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&he();e&&"function"==typeof e.then?re(t,function(t,n){e instanceof te?e._then(t,n):e.then(t,n)}):(t._state=!0,t._value=e,oe(t)),n&&fe()}},ie.bind(null,t))}catch(n){ie(t,n)}}function ie(t,e){if(Ut.push(e),null===t._state){var n=t._lib&&he();e=Ht(e),t._state=!1,t._value=e,ot&&null!==e&&"object"==typeof e&&!e._promise&&function(n,r,i){try{(function(){var n=F(e,"stack");e._promise=t,C(e,"stack",{get:function(){return Rt?n&&(n.get?n.get.apply(e):n.value):t.stack}})}).apply(null,void 0)}catch(o){}}(),function(t){Wt.some(function(e){return e._value===t._value})||Wt.push(t)}(t),oe(t),n&&fe()}}function oe(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)se(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),0===Xt&&(++Xt,$t(function(){0==--Xt&&de()},[]))}function se(t,e){if(null!==t._state){var n=t._state?e.onFulfilled:e.onRejected;if(null===n)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Xt,$t(ae,[n,t,e])}else t._listeners.push(e)}function ae(t,e,n){try{Jt=e;var r,i=e._value;e._state?r=t(i):(Ut.length&&(Ut=[]),r=t(i),-1===Ut.indexOf(i)&&function(t){for(var e=Wt.length;e;)if(Wt[--e]._value===t._value)return void Wt.splice(e,1)}(e)),n.resolve(r)}catch(o){n.reject(o)}finally{Jt=null,0==--Xt&&de(),--n.psd.ref||n.psd.finalize()}}function ue(t,e,n){if(e.length===n)return e;var r="";if(!1===t._state){var i,o,s=t._value;null!=s?(i=s.name||"Error",o=s.message||s,r=ct(s,0)):(i=s,o=""),e.push(i+(o?": "+o:"")+r)}return ot&&((r=ct(t._stackHolder,2))&&-1===e.indexOf(r)&&e.push(r),t._prev&&ue(t._prev,e,n)),e}function le(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function ce(){he()&&fe()}function he(){var t=Lt;return Lt=!1,Vt=!1,t}function fe(){var t,e,n;do{for(;Qt.length>0;)for(t=Qt,Qt=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}}while(Qt.length>0);Lt=!0,Vt=!0}function de(){var t=Wt;Wt=[],t.forEach(function(t){t._PSD.onunhandled.call(null,t._value,t)});for(var e=Zt.slice(0),n=e.length;n;)e[--n]()}function pe(t){return new te(Et,!1,t)}function ye(t,e){var n=Gt;return function(){var r=he(),i=Gt;try{return De(n,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{De(i,!1),r&&fe()}}}D(te.prototype,{then:ee,_then:function(t,e){se(this,new ne(null,null,t,e,Gt))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=arguments[0],n=arguments[1];return this.then(null,"function"==typeof e?function(t){return t instanceof e?n(t):pe(t)}:function(t){return t&&t.name===e?n(t):pe(t)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),pe(e)})},stack:{get:function(){if(this._stack)return this._stack;try{Rt=!0;var t=ue(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{Rt=!1}}},timeout:function(t,e){var n=this;return t<1/0?new te(function(r,i){var o=setTimeout(function(){return i(new wt.Timeout(e))},t);n.then(r,i).finally(clearTimeout.bind(null,o))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&C(te.prototype,Symbol.toStringTag,"Dexie.Promise"),Yt.env=Ae(),D(te,{all:function(){var t=rt.apply(null,arguments).map(_e);return new te(function(e,n){0===t.length&&e([]);var r=t.length;t.forEach(function(i,o){return te.resolve(i).then(function(n){t[o]=n,--r||e(t)},n)})})},resolve:function(t){if(t instanceof te)return t;if(t&&"function"==typeof t.then)return new te(function(e,n){t.then(e,n)});var e=new te(Et,!0,t);return le(e,Jt),e},reject:pe,race:function(){var t=rt.apply(null,arguments).map(_e);return new te(function(e,n){t.map(function(t){return te.resolve(t).then(e,n)})})},PSD:{get:function(){return Gt},set:function(t){return Gt=t}},totalEchoes:{get:function(){return we}},newPSD:xe,usePSD:Ce,scheduler:{get:function(){return $t},set:function(t){$t=t}},rejectionMapper:{get:function(){return Ht},set:function(t){Ht=t}},follow:function(t,e){return new te(function(n,r){return xe(function(e,n){var r=Gt;r.unhandleds=[],r.onunhandled=n,r.finalize=Pt(function(){var t=this;Zt.push(function r(){0===t.unhandleds.length?e():n(t.unhandleds[0]),Zt.splice(Zt.indexOf(r),1)}),++Xt,$t(function(){0==--Xt&&de()},[])},r.finalize),t()},e,n,r)})}}),Kt&&(Kt.allSettled&&C(te,"allSettled",function(){var t=rt.apply(null,arguments).map(_e);return new te(function(e){0===t.length&&e([]);var n=t.length,r=new Array(n);t.forEach(function(t,i){return te.resolve(t).then(function(t){return r[i]={status:"fulfilled",value:t}},function(t){return r[i]={status:"rejected",reason:t}}).then(function(){return--n||e(r)})})})}),Kt.any&&"undefined"!=typeof AggregateError&&C(te,"any",function(){var t=rt.apply(null,arguments).map(_e);return new te(function(e,n){0===t.length&&n(new AggregateError([]));var r=t.length,i=new Array(r);t.forEach(function(t,o){return te.resolve(t).then(function(t){return e(t)},function(t){i[o]=t,--r||n(new AggregateError(i))})})})}));var ve={awaits:0,echoes:0,id:0},me=0,ge=[],be=0,we=0,Ie=0;function xe(t,e,n,r){var i=Gt,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++Ie;var s=Yt.env;o.env=Tt?{Promise:te,PromiseProp:{value:te,configurable:!0,writable:!0},all:te.all,race:te.race,allSettled:te.allSettled,any:te.any,resolve:te.resolve,reject:te.reject,nthen:Fe(s.nthen,o),gthen:Fe(s.gthen,o)}:{},e&&O(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Ce(o,t,n,r);return 0===o.ref&&o.finalize(),a}function ke(){return ve.id||(ve.id=++me),++ve.awaits,ve.echoes+=100,ve.id}function Oe(){return!!ve.awaits&&(0==--ve.awaits&&(ve.id=0),ve.echoes=100*ve.awaits,!0)}function _e(t){return ve.echoes&&t&&t.constructor===Kt?(ke(),t.then(function(t){return Oe(),t},function(t){return Oe(),qe(t)})):t}function Pe(t){++we,ve.echoes&&0!=--ve.echoes||(ve.echoes=ve.id=0),ge.push(Gt),De(t,!0)}function Se(){var t=ge[ge.length-1];ge.pop(),De(t,!1)}function De(t,e){var n=Gt;if((e?!ve.echoes||be++&&t===Gt:!be||--be&&t===Gt)||je(e?Pe.bind(null,t):Se),t!==Gt&&(Gt=t,n===Yt&&(Yt.env=Ae()),Tt)){var r=Yt.env.Promise,i=t.env;Bt.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(k,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Ae(){var t=k.Promise;return Tt?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(k,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Bt.then,gthen:t.prototype.then}:{}}function Ce(t,e,n,r,i){var o=Gt;try{return De(t,!0),e(n,r,i)}finally{De(o,!1)}}function je(t){Nt.call(Mt,t)}function Ee(t,e,n,r){return"function"!=typeof t?t:function(){var i=Gt;n&&ke(),De(e,!0);try{return t.apply(this,arguments)}finally{De(i,!1),r&&je(Oe)}}}function Fe(t,e){return function(n,r){return t.call(this,Ee(n,e),Ee(r,e))}}-1===(""+Nt).indexOf("[native code]")&&(ke=Oe=kt);var Me="unhandledrejection";function Be(t,e){var n;try{n=e.onuncatched(t)}catch(o){}if(!1!==n)try{var r,i={promise:e,reason:t};if(k.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Me,!0,!0),O(r,i)):k.CustomEvent&&O(r=new CustomEvent(Me,{detail:i}),i),r&&k.dispatchEvent&&(dispatchEvent(r),!k.PromiseRejectionEvent&&k.onunhandledrejection))try{k.onunhandledrejection(r)}catch(s){}ot&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(t.stack||t))}catch(o){}}var qe=te.reject;function Ne(t,e,n,r){if(t._state.openComplete||Gt.letThrough){var i=t._createTransaction(e,n,t._dbSchema);try{i.create()}catch(o){return qe(o)}return i._promise(e,function(t,e){return xe(function(){return Gt.trans=i,r(t,e,i)})}).then(function(t){return i._completion.then(function(){return t})})}if(!t._state.isBeingOpened){if(!t._options.autoOpen)return qe(new wt.DatabaseClosed);t.open().catch(kt)}return t._state.dbReadyPromise.then(function(){return Ne(t,e,n,r)})}var Ke="3.0.3",Te=String.fromCharCode(65535),Re=-1/0,ze="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",$e="String expected.",Le=[],Ve="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),We=Ve,Ue=Ve,Je=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)},He="__dbnames",Ye="readonly",Ge="readwrite";function Qe(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var Xe={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ze(t){return function(e){return void 0===R(e,t)&&$(e=Y(e),t),e}}var tn=function(){function t(){}return t.prototype._trans=function(t,e,n){var r=this._tx||Gt.trans,i=this.name;function o(t,n,r){if(!r.schema[i])throw new wt.NotFound("Table "+i+" not part of transaction");return e(r.idbtrans,r)}var s=he();try{return r&&r.db===this.db?r===Gt.trans?r._promise(t,o,n):xe(function(){return r._promise(t,o,n)},{trans:r,transless:Gt.transless||Gt}):Ne(this.db,t,[this.name],o)}finally{s&&fe()}},t.prototype.get=function(t,e){var n=this;return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",function(e){return n.core.get({trans:e,key:t}).then(function(t){return n.hook.reading.fire(t)})}).then(e)},t.prototype.where=function(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(x(t))return new this.db.WhereClause(this,"["+t.join("+")+"]");var e=I(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(t){return t.compound&&e.every(function(e){return t.keyPath.indexOf(e)>=0})&&t.keyPath.every(function(t){return e.indexOf(t)>=0})})[0];if(n&&this.db._maxKey!==Te)return this.where(n.name).equals(n.keyPath.map(function(e){return t[e]}));!n&&ot&&console.warn("The query "+JSON.stringify(t)+" on "+this.name+" would benefit of a compound index ["+e.join("+")+"]");var r=this.schema.idxByName,i=this.db._deps.indexedDB;function o(t,e){try{return 0===i.cmp(t,e)}catch(n){return!1}}var s=e.reduce(function(e,n){var i=e[0],s=e[1],a=r[n],u=t[n];return[i||a,i||!a?Qe(s,a&&a.multi?function(t){var e=R(t,n);return x(e)&&e.some(function(t){return o(u,t)})}:function(t){return o(u,R(t,n))}):s]},[null,null]),a=s[0],u=s[1];return a?this.where(a.name).equals(t[a.keyPath]).filter(u):n?this.filter(u):this.where(e).equals("")},t.prototype.filter=function(t){return this.toCollection().and(t)},t.prototype.count=function(t){return this.toCollection().count(t)},t.prototype.offset=function(t){return this.toCollection().offset(t)},t.prototype.limit=function(t){return this.toCollection().limit(t)},t.prototype.each=function(t){return this.toCollection().each(t)},t.prototype.toArray=function(t){return this.toCollection().toArray(t)},t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},t.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,x(t)?"["+t.join("+")+"]":t))},t.prototype.reverse=function(){return this.toCollection().reverse()},t.prototype.mapToClass=function(t){this.schema.mappedClass=t;var e=function(e){if(!e)return e;var n=Object.create(t.prototype);for(var r in e)if(S(e,r))try{n[r]=e[r]}catch(i){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),t},t.prototype.defineClass=function(){return this.mapToClass(function(t){O(this,t)})},t.prototype.add=function(t,e){var n=this,r=this.schema.primKey,i=r.keyPath,o=t;return i&&r.auto&&(o=Ze(i)(t)),this._trans("readwrite",function(t){return n.core.mutate({trans:t,type:"add",keys:null!=e?[e]:null,values:[o]})}).then(function(t){return t.numFailures?te.reject(t.failures[0]):t.lastResult}).then(function(e){if(i)try{z(t,i,e)}catch(n){}return e})},t.prototype.update=function(t,e){if("object"!=typeof e||x(e))throw new wt.InvalidArgument("Modifications must be an object.");if("object"!=typeof t||x(t))return this.where(":id").equals(t).modify(e);I(e).forEach(function(n){z(t,n,e[n])});var n=R(t,this.schema.primKey.keyPath);return void 0===n?qe(new wt.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(e)},t.prototype.put=function(t,e){var n=this,r=this.schema.primKey,i=r.keyPath,o=t;return i&&r.auto&&(o=Ze(i)(t)),this._trans("readwrite",function(t){return n.core.mutate({trans:t,type:"put",values:[o],keys:null!=e?[e]:null})}).then(function(t){return t.numFailures?te.reject(t.failures[0]):t.lastResult}).then(function(e){if(i)try{z(t,i,e)}catch(n){}return e})},t.prototype.delete=function(t){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"delete",keys:[t]})}).then(function(t){return t.numFailures?te.reject(t.failures[0]):void 0})},t.prototype.clear=function(){var t=this;return this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"deleteRange",range:Xe})}).then(function(t){return t.numFailures?te.reject(t.failures[0]):void 0})},t.prototype.bulkGet=function(t){var e=this;return this._trans("readonly",function(n){return e.core.getMany({keys:t,trans:n}).then(function(t){return t.map(function(t){return e.hook.reading.fire(t)})})})},t.prototype.bulkAdd=function(t,e,n){var r=this,i=Array.isArray(e)?e:void 0,o=(n=n||(i?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",function(e){var n=r.schema.primKey,s=n.auto,a=n.keyPath;if(a&&i)throw new wt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new wt.InvalidArgument("Arguments objects and keys must have the same length");var u=t.length,l=a&&s?t.map(Ze(a)):t;return r.core.mutate({trans:e,type:"add",keys:i,values:l,wantResults:o}).then(function(t){var e=t.numFailures,n=t.failures;if(0===e)return o?t.results:t.lastResult;throw new mt(r.name+".bulkAdd(): "+e+" of "+u+" operations failed",Object.keys(n).map(function(t){return n[t]}))})})},t.prototype.bulkPut=function(t,e,n){var r=this,i=Array.isArray(e)?e:void 0,o=(n=n||(i?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",function(e){var n=r.schema.primKey,s=n.auto,a=n.keyPath;if(a&&i)throw new wt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new wt.InvalidArgument("Arguments objects and keys must have the same length");var u=t.length,l=a&&s?t.map(Ze(a)):t;return r.core.mutate({trans:e,type:"put",keys:i,values:l,wantResults:o}).then(function(t){var e=t.numFailures,n=t.failures;if(0===e)return o?t.results:t.lastResult;throw new mt(r.name+".bulkPut(): "+e+" of "+u+" operations failed",Object.keys(n).map(function(t){return n[t]}))})})},t.prototype.bulkDelete=function(t){var e=this,n=t.length;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"delete",keys:t})}).then(function(t){var r=t.numFailures;if(0===r)return t.lastResult;throw new mt(e.name+".bulkDelete(): "+r+" of "+n+" operations failed",t.failures)})},t}();function en(t){var e={},n=function(n,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return e[n].subscribe.apply(null,o),t}if("string"==typeof n)return e[n]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(t,r,i){if("object"==typeof t)return s(t);r||(r=Ct),i||(i=kt);var o={subscribers:[],fire:i,subscribe:function(t){-1===o.subscribers.indexOf(t)&&(o.subscribers.push(t),o.fire=r(o.fire,t))},unsubscribe:function(t){o.subscribers=o.subscribers.filter(function(e){return e!==t}),o.fire=o.subscribers.reduce(r,i)}};return e[t]=n[t]=o,o}function s(t){I(t).forEach(function(e){var n=t[e];if(x(n))o(e,t[e][0],t[e][1]);else{if("asap"!==n)throw new wt.InvalidArgument("Invalid event config");var r=o(e,Ot,function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];r.subscribers.forEach(function(t){K(function(){t.apply(null,e)})})})}})}}function nn(t,e){return j(e).from({prototype:t}),e}function rn(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function on(t,e){t.filter=Qe(t.filter,e)}function sn(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return Qe(r(),e())}:e,t.justLimit=n&&!r}function an(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(!n)throw new wt.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function un(t,e,n){var r=an(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:"prev"===t.dir,unique:!!t.unique,query:{index:r,range:t.range}})}function ln(t,e,n,r){var i=t.replayFilter?Qe(t.filter,t.replayFilter()):t.filter;if(t.or){var o={},s=function(t,n,r){if(!i||i(n,r,function(t){return n.stop(t)},function(t){return n.fail(t)})){var s=n.primaryKey,a=""+s;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(s)),S(o,a)||(o[a]=!0,e(t,n,r))}};return Promise.all([t.or._iterate(s,n),cn(un(t,r,n),t.algorithm,s,!t.keysOnly&&t.valueMapper)])}return cn(un(t,r,n),Qe(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function cn(t,e,n,r){var i=ye(r?function(t,e,i){return n(r(t),e,i)}:n);return t.then(function(t){if(t)return t.start(function(){var n=function(){return t.continue()};e&&!e(t,function(t){return n=t},function(e){t.stop(e),n=kt},function(e){t.fail(e),n=kt})||i(t.value,t,function(t){return n=t}),n()})})}var hn=function(){function t(){}return t.prototype._read=function(t,e){var n=this._ctx;return n.error?n.table._trans(null,qe.bind(null,n.error)):n.table._trans("readonly",t).then(e)},t.prototype._write=function(t){var e=this._ctx;return e.error?e.table._trans(null,qe.bind(null,e.error)):e.table._trans("readwrite",t,"locked")},t.prototype._addAlgorithm=function(t){var e=this._ctx;e.algorithm=Qe(e.algorithm,t)},t.prototype._iterate=function(t,e){return ln(this._ctx,t,e,this._ctx.table.core)},t.prototype.clone=function(t){var e=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&O(n,t),e._ctx=n,e},t.prototype.raw=function(){return this._ctx.valueMapper=null,this},t.prototype.each=function(t){var e=this._ctx;return this._read(function(n){return ln(e,t,n,e.table.core)})},t.prototype.count=function(t){var e=this;return this._read(function(t){var n=e._ctx,r=n.table.core;if(rn(n,!0))return r.count({trans:t,query:{index:an(n,r.schema),range:n.range}}).then(function(t){return Math.min(t,n.limit)});var i=0;return ln(n,function(){return++i,!1},t,r).then(function(){return i})}).then(t)},t.prototype.sortBy=function(t,e){var n=t.split(".").reverse(),r=n[0],i=n.length-1;function o(t,e){return e?o(t[n[e]],e-1):t[r]}var s="next"===this._ctx.dir?1:-1;function a(t,e){var n=o(t,i),r=o(e,i);return n<r?-s:n>r?s:0}return this.toArray(function(t){return t.sort(a)}).then(e)},t.prototype.toArray=function(t){var e=this;return this._read(function(t){var n=e._ctx;if("next"===n.dir&&rn(n,!0)&&n.limit>0){var r=n.valueMapper,i=an(n,n.table.core.schema);return n.table.core.query({trans:t,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(function(t){var e=t.result;return r?e.map(r):e})}var o=[];return ln(n,function(t){return o.push(t)},t,n.table.core).then(function(){return o})},t)},t.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,rn(e)?sn(e,function(){var e=t;return function(t,n){return 0===e||(1===e?(--e,!1):(n(function(){t.advance(e),e=0}),!1))}}):sn(e,function(){var e=t;return function(){return--e<0}})),this},t.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),sn(this._ctx,function(){var e=t;return function(t,n,r){return--e<=0&&n(r),e>=0}},!0),this},t.prototype.until=function(t,e){return on(this._ctx,function(n,r,i){return!t(n.value)||(r(i),e)}),this},t.prototype.first=function(t){return this.limit(1).toArray(function(t){return t[0]}).then(t)},t.prototype.last=function(t){return this.reverse().first(t)},t.prototype.filter=function(t){var e;return on(this._ctx,function(e){return t(e.value)}),(e=this._ctx).isMatch=Qe(e.isMatch,t),this},t.prototype.and=function(t){return this.filter(t)},t.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},t.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},t.prototype.desc=function(){return this.reverse()},t.prototype.eachKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,n){t(n.key,n)})},t.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},t.prototype.eachPrimaryKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,n){t(n.primaryKey,n)})},t.prototype.keys=function(t){var e=this._ctx;e.keysOnly=!e.isMatch;var n=[];return this.each(function(t,e){n.push(e.key)}).then(function(){return n}).then(t)},t.prototype.primaryKeys=function(t){var e=this._ctx;if("next"===e.dir&&rn(e,!0)&&e.limit>0)return this._read(function(t){var n=an(e,e.table.core.schema);return e.table.core.query({trans:t,values:!1,limit:e.limit,query:{index:n,range:e.range}})}).then(function(t){return t.result}).then(t);e.keysOnly=!e.isMatch;var n=[];return this.each(function(t,e){n.push(e.primaryKey)}).then(function(){return n}).then(t)},t.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},t.prototype.firstKey=function(t){return this.limit(1).keys(function(t){return t[0]}).then(t)},t.prototype.lastKey=function(t){return this.reverse().firstKey(t)},t.prototype.distinct=function(){var t=this._ctx,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var n={};return on(this._ctx,function(t){var e=t.primaryKey.toString(),r=S(n,e);return n[e]=!0,!r}),this},t.prototype.modify=function(t){var e=this,n=this._ctx;return this._write(function(r){var i;if("function"==typeof t)i=t;else{var o=I(t),s=o.length;i=function(e){for(var n=!1,r=0;r<s;++r){var i=o[r],a=t[i];R(e,i)!==a&&(z(e,i,a),n=!0)}return n}}var a=n.table.core,u=a.schema.primaryKey,l=u.outbound,c=u.extractKey,h="testmode"in Zn?1:2e3,f=e.db.core.cmp,d=[],p=0,y=[],v=function(t,e){var n=e.failures;p+=t-e.numFailures;for(var r=0,i=I(n);r<i.length;r++)d.push(n[i[r]])};return e.clone().primaryKeys().then(function(t){var e=function(n){var o=Math.min(h,t.length-n);return a.getMany({trans:r,keys:t.slice(n,n+o)}).then(function(s){for(var u=[],d=[],p=l?[]:null,y=[],m=0;m<o;++m){var g=s[m],b={value:Y(g),primKey:t[n+m]};!1!==i.call(b,b.value,b)&&(null==b.value?y.push(t[n+m]):l||0===f(c(g),c(b.value))?(d.push(b.value),l&&p.push(t[n+m])):(y.push(t[n+m]),u.push(b.value)))}return Promise.resolve(u.length>0&&a.mutate({trans:r,type:"add",values:u}).then(function(t){for(var e in t.failures)y.splice(parseInt(e),1);v(u.length,t)})).then(function(t){return d.length>0&&a.mutate({trans:r,type:"put",keys:p,values:d}).then(function(t){return v(d.length,t)})}).then(function(){return y.length>0&&a.mutate({trans:r,type:"delete",keys:y}).then(function(t){return v(y.length,t)})}).then(function(){return t.length>n+o&&e(n+h)})})};return e(0).then(function(){if(d.length>0)throw new vt("Error modifying one or more objects",d,p,y);return t.length})})})},t.prototype.delete=function(){var t=this._ctx,e=t.range;return rn(t)&&(t.isPrimKey&&!Ue||3===e.type)?this._write(function(n){var r=e;return t.table.core.count({trans:n,query:{index:t.table.core.schema.primaryKey,range:r}}).then(function(e){return t.table.core.mutate({trans:n,type:"deleteRange",range:r}).then(function(t){var n=t.failures,r=t.numFailures;if(r)throw new vt("Could not delete some values",Object.keys(n).map(function(t){return n[t]}),e-r);return e-r})})}):this.modify(function(t,e){return e.value=null})},t}();function fn(t,e){return t<e?-1:t===e?0:1}function dn(t,e){return t>e?-1:t===e?0:1}function pn(t,e,n){var r=t instanceof wn?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function yn(t){return new t.Collection(t,function(){return bn("")}).limit(0)}function vn(t,e,n,r,i,o){for(var s=Math.min(t.length,r.length),a=-1,u=0;u<s;++u){var l=e[u];if(l!==r[u])return i(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):i(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):a>=0?t.substr(0,a)+e[a]+n.substr(a+1):null;i(t[u],l)<0&&(a=u)}return s<r.length&&"next"===o?t+n.substr(t.length):s<t.length&&"prev"===o?t.substr(0,n.length):a<0?null:t.substr(0,a)+r[a]+n.substr(a+1)}function mn(t,e,n,r){var i,o,s,a,u,l,c,h=n.length;if(!n.every(function(t){return"string"==typeof t}))return pn(t,$e);function f(t){i=function(t){return"next"===t?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}(t),o=function(t){return"next"===t?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}(t),s="next"===t?fn:dn;var e=n.map(function(t){return{lower:o(t),upper:i(t)}}).sort(function(t,e){return s(t.lower,e.lower)});a=e.map(function(t){return t.upper}),u=e.map(function(t){return t.lower}),l=t,c="next"===t?"":r}f("next");var d=new t.Collection(t,function(){return gn(a[0],u[h-1]+r)});d._ondirectionchange=function(t){f(t)};var p=0;return d._addAlgorithm(function(t,n,r){var i=t.key;if("string"!=typeof i)return!1;var f=o(i);if(e(f,u,p))return!0;for(var d=null,y=p;y<h;++y){var v=vn(i,f,a[y],u[y],s,l);null===v&&null===d?p=y+1:(null===d||s(d,v)>0)&&(d=v)}return n(null!==d?function(){t.continue(d+c)}:r),!1}),d}function gn(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function bn(t){return{type:1,lower:t,upper:t}}var wn=function(){function t(){}return Object.defineProperty(t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!0,configurable:!0}),t.prototype.between=function(t,e,n,r){n=!1!==n,r=!0===r;try{return this._cmp(t,e)>0||0===this._cmp(t,e)&&(n||r)&&(!n||!r)?yn(this):new this.Collection(this,function(){return gn(t,e,!n,!r)})}catch(i){return pn(this,ze)}},t.prototype.equals=function(t){return null==t?pn(this,ze):new this.Collection(this,function(){return bn(t)})},t.prototype.above=function(t){return null==t?pn(this,ze):new this.Collection(this,function(){return gn(t,void 0,!0)})},t.prototype.aboveOrEqual=function(t){return null==t?pn(this,ze):new this.Collection(this,function(){return gn(t,void 0,!1)})},t.prototype.below=function(t){return null==t?pn(this,ze):new this.Collection(this,function(){return gn(void 0,t,!1,!0)})},t.prototype.belowOrEqual=function(t){return null==t?pn(this,ze):new this.Collection(this,function(){return gn(void 0,t)})},t.prototype.startsWith=function(t){return"string"!=typeof t?pn(this,$e):this.between(t,t+Te,!0,!0)},t.prototype.startsWithIgnoreCase=function(t){return""===t?this.startsWith(t):mn(this,function(t,e){return 0===t.indexOf(e[0])},[t],Te)},t.prototype.equalsIgnoreCase=function(t){return mn(this,function(t,e){return t===e[0]},[t],"")},t.prototype.anyOfIgnoreCase=function(){var t=rt.apply(nt,arguments);return 0===t.length?yn(this):mn(this,function(t,e){return-1!==e.indexOf(t)},t,"")},t.prototype.startsWithAnyOfIgnoreCase=function(){var t=rt.apply(nt,arguments);return 0===t.length?yn(this):mn(this,function(t,e){return e.some(function(e){return 0===t.indexOf(e)})},t,Te)},t.prototype.anyOf=function(){var t=this,e=rt.apply(nt,arguments),n=this._cmp;try{e.sort(n)}catch(o){return pn(this,ze)}if(0===e.length)return yn(this);var r=new this.Collection(this,function(){return gn(e[0],e[e.length-1])});r._ondirectionchange=function(r){e.sort(n="next"===r?t._ascending:t._descending)};var i=0;return r._addAlgorithm(function(t,r,o){for(var s=t.key;n(s,e[i])>0;)if(++i===e.length)return r(o),!1;return 0===n(s,e[i])||(r(function(){t.continue(e[i])}),!1)}),r},t.prototype.notEqual=function(t){return this.inAnyRange([[Re,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},t.prototype.noneOf=function(){var t=rt.apply(nt,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch(n){return pn(this,ze)}var e=t.reduce(function(t,e){return t?t.concat([[t[t.length-1][1],e]]):[[Re,e]]},null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},t.prototype.inAnyRange=function(t,e){var n=this,r=this._cmp,i=this._ascending,o=this._descending,s=this._min,a=this._max;if(0===t.length)return yn(this);if(!t.every(function(t){return void 0!==t[0]&&void 0!==t[1]&&i(t[0],t[1])<=0}))return pn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",wt.InvalidArgument);var u,l=!e||!1!==e.includeLowers,c=e&&!0===e.includeUppers,h=i;function f(t,e){return h(t[0],e[0])}try{(u=t.reduce(function(t,e){for(var n=0,i=t.length;n<i;++n){var o=t[n];if(r(e[0],o[1])<0&&r(e[1],o[0])>0){o[0]=s(o[0],e[0]),o[1]=a(o[1],e[1]);break}}return n===i&&t.push(e),t},[])).sort(f)}catch(g){return pn(this,ze)}var d=0,p=c?function(t){return i(t,u[d][1])>0}:function(t){return i(t,u[d][1])>=0},y=l?function(t){return o(t,u[d][0])>0}:function(t){return o(t,u[d][0])>=0},v=p,m=new this.Collection(this,function(){return gn(u[0][0],u[u.length-1][1],!l,!c)});return m._ondirectionchange=function(t){"next"===t?(v=p,h=i):(v=y,h=o),u.sort(f)},m._addAlgorithm(function(t,e,r){for(var o=t.key;v(o);)if(++d===u.length)return e(r),!1;return!!function(t){return!p(t)&&!y(t)}(o)||(0===n._cmp(o,u[d][1])||0===n._cmp(o,u[d][0])||e(function(){t.continue(h===i?u[d][0]:u[d][1])}),!1)}),m},t.prototype.startsWithAnyOf=function(){var t=rt.apply(nt,arguments);return t.every(function(t){return"string"==typeof t})?0===t.length?yn(this):this.inAnyRange(t.map(function(t){return[t,t+Te]})):pn(this,"startsWithAnyOf() only works with strings")},t}();function In(t){return 1===t.length?t[0]:t}function xn(t){try{return t.only([[]]),[[]]}catch(e){return Te}}function kn(t){return ye(function(e){return On(e),t(e.target.error),!1})}function On(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var _n=function(){function t(){}return t.prototype._lock=function(){return N(!Gt.global),++this._reculock,1!==this._reculock||Gt.global||(Gt.lockOwnerFor=this),this},t.prototype._unlock=function(){if(N(!Gt.global),0==--this._reculock)for(Gt.global||(Gt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{Ce(t[1],t[0])}catch(e){}}return this},t.prototype._locked=function(){return this._reculock&&Gt.lockOwnerFor!==this},t.prototype.create=function(t){var e=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(N(!this.idbtrans),!t&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new wt.DatabaseClosed(r);case"MissingAPIError":throw new wt.MissingAPI(r.message,r);default:throw new wt.OpenFailed(r)}if(!this.active)throw new wt.TransactionInactive;return N(null===this._completion._state),(t=this.idbtrans=t||n.transaction(In(this.storeNames),this.mode)).onerror=ye(function(n){On(n),e._reject(t.error)}),t.onabort=ye(function(n){On(n),e.active&&e._reject(new wt.Abort(t.error)),e.active=!1,e.on("abort").fire(n)}),t.oncomplete=ye(function(){e.active=!1,e._resolve()}),this},t.prototype._promise=function(t,e,n){var r=this;if("readwrite"===t&&"readwrite"!==this.mode)return qe(new wt.ReadOnly("Transaction is readonly"));if(!this.active)return qe(new wt.TransactionInactive);if(this._locked())return new te(function(i,o){r._blockedFuncs.push([function(){r._promise(t,e,n).then(i,o)},Gt])});if(n)return xe(function(){var t=new te(function(t,n){r._lock();var i=e(t,n,r);i&&i.then&&i.then(t,n)});return t.finally(function(){return r._unlock()}),t._lib=!0,t});var i=new te(function(t,n){var i=e(t,n,r);i&&i.then&&i.then(t,n)});return i._lib=!0,i},t.prototype._root=function(){return this.parent?this.parent._root():this},t.prototype.waitFor=function(t){var e=this._root(),n=te.resolve(t);if(e._waitingFor)e._waitingFor=e._waitingFor.then(function(){return n});else{e._waitingFor=n,e._waitingQueue=[];var r=e.idbtrans.objectStore(e.storeNames[0]);!function t(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(r.get(-1/0).onsuccess=t)}()}var i=e._waitingFor;return new te(function(t,r){n.then(function(n){return e._waitingQueue.push(ye(t.bind(null,n)))},function(t){return e._waitingQueue.push(ye(r.bind(null,t)))}).finally(function(){e._waitingFor===i&&(e._waitingFor=null)})})},t.prototype.abort=function(){this.active&&this._reject(new wt.Abort),this.active=!1},t.prototype.table=function(t){var e=this._memoizedTables||(this._memoizedTables={});if(S(e,t))return e[t];var n=this.schema[t];if(!n)throw new wt.NotFound("Table "+t+" not part of transaction");var r=new this.db.Table(t,n,this);return r.core=this.db.core.table(t),e[t]=r,r},t}();function Pn(t,e,n,r,i,o,s){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:o,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+Sn(e)}}function Sn(t){return"string"==typeof t?t:t?"["+[].join.call(t,"+")+"]":""}function Dn(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:T(n,function(t){return[t.name,t]})}}function An(t){return null==t?function(){}:"string"==typeof t?function(t){return 1===t.split(".").length?function(e){return e[t]}:function(e){return R(e,t)}}(t):function(e){return R(e,t)}}function Cn(t,e){return"delete"===e.type?e.keys:e.keys||e.values.map(t.extractKey)}function jn(t){return[].slice.call(t)}var En=0;function Fn(t){return null==t?":id":"string"==typeof t?t:"["+t.join("+")+"]"}function Mn(t,e,n,r){var i=e.cmp.bind(e);function o(t){if(3===t.type)return null;if(4===t.type)throw new Error("Cannot convert never type to IDBKeyRange");var e=t.lower,r=t.upper,i=t.lowerOpen,o=t.upperOpen;return void 0===e?void 0===r?null:n.upperBound(r,!!o):void 0===r?n.lowerBound(e,!!i):n.bound(e,r,!!i,!!o)}var s=function(t,e){var n=jn(t.objectStoreNames);return{schema:{name:t.name,tables:n.map(function(t){return e.objectStore(t)}).map(function(t){var e=t.keyPath,n=t.autoIncrement,r=x(e),i={},o={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==e,compound:r,keyPath:e,autoIncrement:n,unique:!0,extractKey:An(e)},indexes:jn(t.indexNames).map(function(e){return t.index(e)}).map(function(t){var e=t.unique,n=t.multiEntry,r=t.keyPath,o={name:t.name,compound:x(r),keyPath:r,unique:e,multiEntry:n,extractKey:An(r)};return i[Fn(r)]=o,o}),getIndexByKeyPath:function(t){return i[Fn(t)]}};return i[":id"]=o.primaryKey,null!=e&&(i[Fn(e)]=o.primaryKey),o})},hasGetAll:n.length>0&&"getAll"in e.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,r),a=s.schema,u=s.hasGetAll,l=a.tables.map(function(t){return function(t){var e=t.name;return{name:e,schema:t,mutate:function(n){var r=n.trans,i=n.type,s=n.keys,a=n.values,u=n.range,l=n.wantResults;return new Promise(function(n,c){n=ye(n);var h=r.objectStore(e),f=null==h.keyPath,d="put"===i||"add"===i;if(!d&&"delete"!==i&&"deleteRange"!==i)throw new Error("Invalid operation type: "+i);var p=(s||a||{length:1}).length;if(s&&a&&s.length!==a.length)throw new Error("Given keys array must have same length as given values array.");if(0===p)return n({numFailures:0,failures:{},results:[],lastResult:void 0});var y,v=l&&w(s||Cn(t.primaryKey,{type:i,keys:s,values:a})),m=[],g=0,b=function(t){++g,On(t),v&&(v[t.target._reqno]=void 0),m[t.target._reqno]=t.target.error},I=function(t){var e=t.target;v[e._reqno]=e.result};if("deleteRange"===i){if(4===u.type)return n({numFailures:g,failures:m,results:v,lastResult:void 0});y=3===u.type?h.clear():h.delete(o(u))}else{var x=d?f?[a,s]:[a,null]:[s,null],k=x[0],O=x[1];if(d)for(var _=0;_<p;++_)(y=O&&void 0!==O[_]?h[i](k[_],O[_]):h[i](k[_]))._reqno=_,v&&void 0===v[_]&&(y.onsuccess=I),y.onerror=b;else for(_=0;_<p;++_)(y=h[i](k[_]))._reqno=_,y.onerror=b}var P=function(t){var e=t.target.result;v&&(v[p-1]=e),n({numFailures:g,failures:m,results:v,lastResult:e})};y.onerror=function(t){b(t),P(t)},y.onsuccess=P})},getMany:function(t){var n=t.trans,r=t.keys;return new Promise(function(t,i){t=ye(t);for(var o,s=n.objectStore(e),a=r.length,u=new Array(a),l=0,c=0,h=function(e){var n=e.target;u[n._pos]=n.result,++c===l&&t(u)},f=kn(i),d=0;d<a;++d)null!=r[d]&&((o=s.get(r[d]))._pos=d,o.onsuccess=h,o.onerror=f,++l);0===l&&t(u)})},get:function(t){var n=t.trans,r=t.key;return new Promise(function(t,i){t=ye(t);var o=n.objectStore(e).get(r);o.onsuccess=function(e){return t(e.target.result)},o.onerror=kn(i)})},query:function(t){return function(n){return new Promise(function(r,i){r=ye(r);var s=n.values,a=n.limit,u=n.query,l=a===1/0?void 0:a,c=u.index,h=u.range,f=n.trans.objectStore(e),d=c.isPrimaryKey?f:f.index(c.name),p=o(h);if(0===a)return r({result:[]});if(t){var y=s?d.getAll(p,l):d.getAllKeys(p,l);y.onsuccess=function(t){return r({result:t.target.result})},y.onerror=kn(i)}else{var v=0,m=s||!("openKeyCursor"in d)?d.openCursor(p):d.openKeyCursor(p),g=[];m.onsuccess=function(t){var e=m.result;return e?(g.push(s?e.value:e.primaryKey),++v===a?r({result:g}):void e.continue()):r({result:g})},m.onerror=kn(i)}})}}(u),openCursor:function(t){var n=t.trans,r=t.values,i=t.query,s=t.reverse,a=t.unique;return new Promise(function(t,u){t=ye(t);var l=i.index,c=i.range,h=n.objectStore(e),f=l.isPrimaryKey?h:h.index(l.name),d=s?a?"prevunique":"prev":a?"nextunique":"next",p=r||!("openKeyCursor"in f)?f.openCursor(o(c),d):f.openKeyCursor(o(c),d);p.onerror=kn(u),p.onsuccess=ye(function(e){var r=p.result;if(r){r.___id=++En,r.done=!1;var i=r.continue.bind(r),o=r.continuePrimaryKey;o&&(o=o.bind(r));var s=r.advance.bind(r),a=function(){throw new Error("Cursor not stopped")};r.trans=n,r.stop=r.continue=r.continuePrimaryKey=r.advance=function(){throw new Error("Cursor not started")},r.fail=ye(u),r.next=function(){var t=this,e=1;return this.start(function(){return e--?t.continue():t.stop()}).then(function(){return t})},r.start=function(t){var e=new Promise(function(t,e){t=ye(t),p.onerror=kn(e),r.fail=e,r.stop=function(e){r.stop=r.continue=r.continuePrimaryKey=r.advance=a,t(e)}}),n=function(){if(p.result)try{t()}catch(e){r.fail(e)}else r.done=!0,r.start=function(){throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=ye(function(t){p.onsuccess=n,n()}),r.continue=i,r.continuePrimaryKey=o,r.advance=s,n(),e},t(r)}else t(null)},u)})},count:function(t){var n=t.query,r=t.trans,i=n.index,s=n.range;return new Promise(function(t,n){var a=r.objectStore(e),u=i.isPrimaryKey?a:a.index(i.name),l=o(s),c=l?u.count(l):u.count();c.onsuccess=ye(function(e){return t(e.target.result)}),c.onerror=kn(n)})}}}(t)}),c={};return l.forEach(function(t){return c[t.name]=t}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(t){if(!c[t])throw new Error("Table '"+t+"' not found");return c[t]},cmp:i,MIN_KEY:-1/0,MAX_KEY:xn(n),schema:a}}function Bn(t,e){var n=function(t,e,n,r){return{dbcore:function(t,e){return e.reduce(function(t,e){var n=e.create;return b(b({},t),n(t))},t)}(Mn(e,n.indexedDB,n.IDBKeyRange,r),t.dbcore)}}(t._middlewares,e.db,t._deps,e);t.core=n.dbcore,t.tables.forEach(function(e){var n=e.name;t.core.schema.tables.some(function(t){return t.name===n})&&(e.core=t.core.table(n),t[n]instanceof t.Table&&(t[n].core=e.core))})}function qn(t,e,n,r){n.forEach(function(n){var i=r[n];e.forEach(function(e){var r=F(e,n);(!r||"value"in r&&void 0===r.value)&&(e===t.Transaction.prototype||e instanceof t.Transaction?C(e,n,{get:function(){return this.table(n)},set:function(t){A(this,n,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):e[n]=new t.Table(n,i))})})}function Nn(t,e){e.forEach(function(e){for(var n in e)e[n]instanceof t.Table&&delete e[n]})}function Kn(t,e){return t._cfg.version-e._cfg.version}function Tn(t,e){var n,r={del:[],add:[],change:[]};for(n in t)e[n]||r.del.push(n);for(n in e){var i=t[n],o=e[n];if(i){var s={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!Ve)s.recreate=!0,r.change.push(s);else{var a=i.idxByName,u=o.idxByName,l=void 0;for(l in a)u[l]||s.del.push(l);for(l in u){var c=a[l],h=u[l];c?c.src!==h.src&&s.change.push(h):s.add.push(h)}(s.del.length>0||s.add.length>0||s.change.length>0)&&r.change.push(s)}}else r.add.push([n,o])}return r}function Rn(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(t){return zn(i,t)}),i}function zn(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function $n(t,e,n){var r={};return B(e.objectStoreNames,0).forEach(function(t){for(var e=n.objectStore(t),i=e.keyPath,o=Pn(Sn(i),i||"",!1,!1,!!e.autoIncrement,i&&"string"!=typeof i,!0),s=[],a=0;a<e.indexNames.length;++a){var u=e.index(e.indexNames[a]),l=Pn(u.name,i=u.keyPath,!!u.unique,!!u.multiEntry,!1,i&&"string"!=typeof i,!1);s.push(l)}r[t]=Dn(t,o,s)}),r}function Ln(t,e,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var o=r[i],s=n.objectStore(o);t._hasGetAll="getAll"in s;for(var a=0;a<s.indexNames.length;++a){var u=s.indexNames[a],l=s.index(u).keyPath,c="string"==typeof l?l:"["+B(l).join("+")+"]";if(e[o]){var h=e[o].idxByName[c];h&&(h.name=u,delete e[o].idxByName[c],e[o].idxByName[u]=h)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&k.WorkerGlobalScope&&k instanceof k.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}var Vn,Wn=function(){function t(){}return t.prototype._parseStoresSpec=function(t,e){I(t).forEach(function(n){if(null!==t[n]){var r=t[n].split(",").map(function(t,e){var n=(t=t.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return Pn(n,r||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),x(r),0===e)}),i=r.shift();if(i.multi)throw new wt.Schema("Primary key cannot be multi-valued");r.forEach(function(t){if(t.auto)throw new wt.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new wt.Schema("Index must have a name and cannot be an empty string")}),e[n]=Dn(n,i,r)}})},t.prototype.stores=function(t){var e=this.db;this._cfg.storesSource=this._cfg.storesSource?O(this._cfg.storesSource,t):t;var n={},r={};return e._versions.forEach(function(t){O(n,t._cfg.storesSource),r=t._cfg.dbschema={},t._parseStoresSpec(n,r)}),e._dbSchema=r,Nn(e,[e._allTables,e,e.Transaction.prototype]),qn(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],I(r),r),e._storeNames=I(r),this},t.prototype.upgrade=function(t){return this._cfg.contentUpgrade=t,this},t}();function Un(t){return xe(function(){return Gt.letThrough=!0,t()})}function Jn(t){var e=function(e){return t.next(e)},n=i(e),r=i(function(e){return t.throw(e)});function i(t){return function(e){var i=t(e),o=i.value;return i.done?o:o&&"function"==typeof o.then?o.then(n,r):x(o)?Promise.all(o).then(n,r):n(o)}}return i(e)()}function Hn(t,e,n){var r=arguments.length;if(r<2)throw new wt.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var o=W(i);return[t,o,n]}function Yn(t,e,n,r,i){return te.resolve().then(function(){var o=Gt.transless||Gt,s=t._createTransaction(e,n,t._dbSchema,r),a={trans:s,transless:o};r?s.idbtrans=r.idbtrans:s.create();var u,l=it(i);l&&ke();var c=te.follow(function(){if(u=i.call(s,s))if(l){var t=Oe.bind(null,null);u.then(t,t)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=Jn(u))},a);return(u&&"function"==typeof u.then?te.resolve(u).then(function(t){return s.active?t:qe(new wt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):c.then(function(){return u})).then(function(t){return r&&s._resolve(),s._completion.then(function(){return t})}).catch(function(t){return s._reject(t),qe(t)})})}function Gn(t,e,n){for(var r=x(t)?t.slice():[t],i=0;i<n;++i)r.push(e);return r}var Qn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return b(b({},t),{table:function(e){var n=t.table(e),r=n.schema,i={},o=[];function s(t,e,n){var r=Fn(t),a=i[r]=i[r]||[],u=null==t?0:"string"==typeof t?1:t.length,l=e>0,c=b(b({},n),{isVirtual:l,isPrimaryKey:!l&&n.isPrimaryKey,keyTail:e,keyLength:u,extractKey:An(t),unique:!l&&n.unique});return a.push(c),c.isPrimaryKey||o.push(c),u>1&&s(2===u?t[0]:t.slice(0,u-1),e+1,n),a.sort(function(t,e){return t.keyTail-e.keyTail}),c}var a=s(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(var u=0,l=r.indexes;u<l.length;u++){var c=l[u];s(c.keyPath,0,c)}function h(e){var n,r,i=e.query.index;return i.isVirtual?b(b({},e),{query:{index:i,range:(n=e.query.range,r=i.keyTail,{type:1===n.type?2:n.type,lower:Gn(n.lower,n.lowerOpen?t.MAX_KEY:t.MIN_KEY,r),lowerOpen:!0,upper:Gn(n.upper,n.upperOpen?t.MIN_KEY:t.MAX_KEY,r),upperOpen:!0})}}):e}return b(b({},n),{schema:b(b({},r),{primaryKey:a,indexes:o,getIndexByKeyPath:function(t){var e=i[Fn(t)];return e&&e[0]}}),count:function(t){return n.count(h(t))},query:function(t){return n.query(h(t))},openCursor:function(e){var r=e.query.index,i=r.keyTail,o=r.keyLength;return r.isVirtual?n.openCursor(h(e)).then(function(n){return n&&function(n){return Object.create(n,{continue:{value:function(r){null!=r?n.continue(Gn(r,e.reverse?t.MAX_KEY:t.MIN_KEY,i)):e.unique?n.continue(Gn(n.key,e.reverse?t.MIN_KEY:t.MAX_KEY,i)):n.continue()}},continuePrimaryKey:{value:function(e,r){n.continuePrimaryKey(Gn(e,t.MAX_KEY,i),r)}},key:{get:function(){var t=n.key;return 1===o?t[0]:t.slice(0,o)}},value:{get:function(){return n.value}}})}(n)}):n.openCursor(e)}})}})}},Xn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return b(b({},t),{table:function(e){var n=t.table(e),r=n.schema.primaryKey;return b(b({},n),{mutate:function(t){var i=Gt.trans,o=i.table(e).hook,s=o.deleting,a=o.creating,u=o.updating;switch(t.type){case"add":if(a.fire===kt)break;return i._promise("readwrite",function(){return l(t)},!0);case"put":if(a.fire===kt&&u.fire===kt)break;return i._promise("readwrite",function(){return l(t)},!0);case"delete":if(s.fire===kt)break;return i._promise("readwrite",function(){return l(t)},!0);case"deleteRange":if(s.fire===kt)break;return i._promise("readwrite",function(){return function(t){return c(t.trans,t.range,1e4)}(t)},!0)}return n.mutate(t);function l(t){var e=Gt.trans,i=t.keys||Cn(r,t);if(!i)throw new Error("Keys missing");return"delete"!==(t="add"===t.type||"put"===t.type?b(b({},t),{keys:i,wantResults:!0}):b({},t)).type&&(t.values=w(t.values)),t.keys&&(t.keys=w(t.keys)),function(t,e,n){return"add"===e.type?Promise.resolve(new Array(e.values.length)):t.getMany({trans:e.trans,keys:n})}(n,t,i).then(function(o){var l=i.map(function(n,i){var l=o[i],c={onerror:null,onsuccess:null};if("delete"===t.type)s.fire.call(c,n,l,e);else if("add"===t.type||void 0===l){var h=a.fire.call(c,n,t.values[i],e);null==n&&null!=h&&(t.keys[i]=n=h,r.outbound||z(t.values[i],r.keyPath,n))}else{var f=Z(l,t.values[i]),d=u.fire.call(c,f,n,l,e);if(d){var p=t.values[i];Object.keys(d).forEach(function(t){S(p,t)?p[t]=d[t]:z(p,t,d[t])})}}return c});return n.mutate(t).then(function(e){for(var n=e.failures,r=e.results,s=e.numFailures,a=e.lastResult,u=0;u<i.length;++u){var c=r?r[u]:i[u],h=l[u];null==c?h.onerror&&h.onerror(n[u]):h.onsuccess&&h.onsuccess("put"===t.type&&o[u]?t.values[u]:c)}return{failures:n,results:r,numFailures:s,lastResult:a}}).catch(function(t){return l.forEach(function(e){return e.onerror&&e.onerror(t)}),Promise.reject(t)})})}function c(t,e,i){return n.query({trans:t,values:!1,query:{index:r,range:e},limit:i}).then(function(n){var r=n.result;return l({type:"delete",keys:r,trans:t}).then(function(n){return n.numFailures>0?Promise.reject(n.failures[0]):r.length<i?{failures:[],numFailures:0,lastResult:void 0}:c(t,b(b({},e),{lower:r[r.length-1],lowerOpen:!0}),i)})})}}})}})}},Zn=function(){function t(e,n){var r=this;this._middlewares={},this.verno=0;var i=t.dependencies;this._options=n=b({addons:t.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var o=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null;var s,a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:kt,dbReadyPromise:null,cancelOpen:kt,openCanceller:null,autoSchema:!0};a.dbReadyPromise=new te(function(t){a.dbReadyResolve=t}),a.openCanceller=new te(function(t,e){a.cancelOpen=e}),this._state=a,this.name=e,this.on=en(this,"populate","blocked","versionchange",{ready:[jt,kt]}),this.on.ready.subscribe=q(this.on.ready.subscribe,function(e){return function(n,i){t.vip(function(){var t=r._state;if(t.openComplete)t.dbOpenError||te.resolve().then(n),i&&e(n);else if(t.onReadyBeingFired)t.onReadyBeingFired.push(n),i&&e(n);else{e(n);var o=r;i||e(function t(){o.on.ready.unsubscribe(n),o.on.ready.unsubscribe(t)})}})}}),this.Collection=(s=this,nn(hn.prototype,function(t,e){this.db=s;var n=Xe,r=null;if(e)try{n=e()}catch(u){r=u}var i=t._ctx,o=i.table,a=o.hook.reading.fire;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:a!==Ot?a:null}})),this.Table=function(t){return nn(tn.prototype,function(e,n,r){this.db=t,this._tx=r,this.name=e,this.schema=n,this.hook=t._allTables[e]?t._allTables[e].hook:en(null,{creating:[St,kt],reading:[_t,Ot],updating:[At,kt],deleting:[Dt,kt]})})}(this),this.Transaction=function(t){return nn(_n.prototype,function(e,n,r,i){var o=this;this.db=t,this.mode=e,this.storeNames=n,this.schema=r,this.idbtrans=null,this.on=en(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new te(function(t,e){o._resolve=t,o._reject=e}),this._completion.then(function(){o.active=!1,o.on.complete.fire()},function(t){var e=o.active;return o.active=!1,o.on.error.fire(t),o.parent?o.parent._reject(t):e&&o.idbtrans&&o.idbtrans.abort(),qe(t)})})}(this),this.Version=function(t){return nn(Wn.prototype,function(e){this.db=t,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(t){return nn(wn.prototype,function(e,n,r){this.db=t,this._ctx={table:e,index:":id"===n?null:n,or:r};var i=t._deps.indexedDB;if(!i)throw new wt.MissingAPI("indexedDB API missing");this._cmp=this._ascending=i.cmp.bind(i),this._descending=function(t,e){return i.cmp(e,t)},this._max=function(t,e){return i.cmp(t,e)>0?t:e},this._min=function(t,e){return i.cmp(t,e)<0?t:e},this._IDBKeyRange=t._deps.IDBKeyRange})}(this),this.on("versionchange",function(t){t.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()}),this.on("blocked",function(t){!t.newVersion||t.newVersion<t.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+t.oldVersion/10)}),this._maxKey=xn(n.IDBKeyRange),this._createTransaction=function(t,e,n,i){return new r.Transaction(t,e,n,i)},this._fireOnBlocked=function(t){r.on("blocked").fire(t),Le.filter(function(t){return t.name===r.name&&t!==r&&!t._state.vcFired}).map(function(e){return e.on("versionchange").fire(t)})},this.use(Qn),this.use(Xn),o.forEach(function(t){return t(r)})}return t.prototype.version=function(t){if(isNaN(t)||t<.1)throw new wt.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new wt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,n=e.filter(function(e){return e._cfg.version===t})[0];return n||(n=new this.Version(t),e.push(n),e.sort(Kn),n.stores({}),this._state.autoSchema=!1,n)},t.prototype._whenReady=function(t){var e=this;return this._state.openComplete||Gt.letThrough?t():new te(function(t,n){if(!e._state.isBeingOpened){if(!e._options.autoOpen)return void n(new wt.DatabaseClosed);e.open().catch(kt)}e._state.dbReadyPromise.then(t,n)}).then(t)},t.prototype.use=function(t){var e=t.stack,n=t.create,r=t.level,i=t.name;i&&this.unuse({stack:e,name:i});var o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:n,level:null==r?10:r,name:i}),o.sort(function(t,e){return t.level-e.level}),this},t.prototype.unuse=function(t){var e=t.stack,n=t.name,r=t.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(function(t){return r?t.create!==r:!!n&&t.name!==n})),this},t.prototype.open=function(){return function(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?qe(e.dbOpenError):t});ot&&(e.openCanceller._stackHolder=lt()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.dbReadyResolve,i=null;return te.race([e.openCanceller,new te(function(r,o){if(!n)throw new wt.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var s=t.name,a=e.autoSchema?n.open(s):n.open(s,Math.round(10*t.verno));if(!a)throw new wt.MissingAPI("IndexedDB API not available");a.onerror=kn(o),a.onblocked=ye(t._fireOnBlocked),a.onupgradeneeded=ye(function(r){if(i=a.transaction,e.autoSchema&&!t._options.allowEmptyDB){a.onerror=On,i.abort(),a.result.close();var u=n.deleteDatabase(s);u.onsuccess=u.onerror=ye(function(){o(new wt.NoSuchDatabase("Database "+s+" doesnt exist"))})}else{i.onerror=kn(o);var l=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;t.idbdb=a.result,function(t,e,n,r){var i=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,i);o.create(n),o._completion.catch(r);var s=o._reject.bind(o),a=Gt.transless||Gt;xe(function(){Gt.trans=o,Gt.transless=a,0===e?(I(i).forEach(function(t){Rn(n,t,i[t].primKey,i[t].indexes)}),Bn(t,n),te.follow(function(){return t.on.populate.fire(o)}).catch(s)):function(t,e,n,r){var i=[],o=t._versions,s=t._dbSchema=$n(0,t.idbdb,r),a=!1;return o.filter(function(t){return t._cfg.version>=e}).forEach(function(o){i.push(function(){var i=s,u=o._cfg.dbschema;Ln(t,i,r),Ln(t,u,r),s=t._dbSchema=u;var l=Tn(i,u);l.add.forEach(function(t){Rn(r,t[0],t[1].primKey,t[1].indexes)}),l.change.forEach(function(t){if(t.recreate)throw new wt.Upgrade("Not yet support for changing primary key");var e=r.objectStore(t.name);t.add.forEach(function(t){return zn(e,t)}),t.change.forEach(function(t){e.deleteIndex(t.name),zn(e,t)}),t.del.forEach(function(t){return e.deleteIndex(t)})});var c=o._cfg.contentUpgrade;if(c&&o._cfg.version>e){Bn(t,r),n._memoizedTables={},a=!0;var h=L(u);l.del.forEach(function(t){h[t]=i[t]}),Nn(t,[t.Transaction.prototype]),qn(t,[t.Transaction.prototype],I(h),h),n.schema=h;var f,d=it(c);d&&ke();var p=te.follow(function(){if((f=c(n))&&d){var t=Oe.bind(null,null);f.then(t,t)}});return f&&"function"==typeof f.then?te.resolve(f):p.then(function(){return f})}}),i.push(function(e){a&&We||function(t,e){for(var n=0;n<e.db.objectStoreNames.length;++n){var r=e.db.objectStoreNames[n];null==t[r]&&e.db.deleteObjectStore(r)}}(o._cfg.dbschema,e),Nn(t,[t.Transaction.prototype]),qn(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),n.schema=t._dbSchema})}),function t(){return i.length?te.resolve(i.shift()(n.idbtrans)).then(t):te.resolve()}().then(function(){var t,e;e=r,I(t=s).forEach(function(n){e.db.objectStoreNames.contains(n)||Rn(e,n,t[n].primKey,t[n].indexes)})})}(t,e,o,n).catch(s)})}(t,l/10,i,o)}},o),a.onsuccess=ye(function(){i=null;var n=t.idbdb=a.result,o=B(n.objectStoreNames);if(o.length>0)try{var u=n.transaction(In(o),"readonly");e.autoSchema?function(t,e,n){t.verno=e.version/10;var r=t._dbSchema=$n(0,e,n);t._storeNames=B(e.objectStoreNames,0),qn(t,[t._allTables],I(r),r)}(t,n,u):(Ln(t,t._dbSchema,u),function(t,e){var n=Tn($n(0,t.idbdb,e),t._dbSchema);return!(n.add.length||n.change.some(function(t){return t.add.length||t.change.length}))}(t,u)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Bn(t,u)}catch(l){}Le.push(t),n.onversionchange=ye(function(n){e.vcFired=!0,t.on("versionchange").fire(n)}),Vn.add(s),r()},o)})]).then(function(){return e.onReadyBeingFired=[],te.resolve(Un(t.on.ready.fire)).then(function t(){if(e.onReadyBeingFired.length>0){var n=e.onReadyBeingFired.reduce(jt,kt);return e.onReadyBeingFired=[],te.resolve(Un(n)).then(t)}})}).finally(function(){e.onReadyBeingFired=null}).then(function(){return e.isBeingOpened=!1,t}).catch(function(n){try{i&&i.abort()}catch(r){}return e.isBeingOpened=!1,t.close(),e.dbOpenError=n,qe(e.dbOpenError)}).finally(function(){e.openComplete=!0,r()})}(this)},t.prototype.close=function(){var t=Le.indexOf(this),e=this._state;if(t>=0&&Le.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(n){}this.idbdb=null}this._options.autoOpen=!1,e.dbOpenError=new wt.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError),e.dbReadyPromise=new te(function(t){e.dbReadyResolve=t}),e.openCanceller=new te(function(t,n){e.cancelOpen=n})},t.prototype.delete=function(){var t=this,e=arguments.length>0,n=this._state;return new te(function(r,i){var o=function(){t.close();var e=t._deps.indexedDB.deleteDatabase(t.name);e.onsuccess=ye(function(){Vn.remove(t.name),r()}),e.onerror=kn(i),e.onblocked=t._fireOnBlocked};if(e)throw new wt.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(o):o()})},t.prototype.backendDB=function(){return this.idbdb},t.prototype.isOpen=function(){return null!==this.idbdb},t.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name},t.prototype.hasFailed=function(){return null!==this._state.dbOpenError},t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(t.prototype,"tables",{get:function(){var t=this;return I(this._allTables).map(function(e){return t._allTables[e]})},enumerable:!0,configurable:!0}),t.prototype.transaction=function(){var t=Hn.apply(this,arguments);return this._transaction.apply(this,t)},t.prototype._transaction=function(t,e,n){var r=this,i=Gt.trans;i&&i.db===this&&-1===t.indexOf("!")||(i=null);var o,s,a=-1!==t.indexOf("?");t=t.replace("!","").replace("?","");try{if(s=e.map(function(t){var e=t instanceof r.Table?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e}),"r"==t||t===Ye)o=Ye;else{if("rw"!=t&&t!=Ge)throw new wt.InvalidArgument("Invalid transaction mode: "+t);o=Ge}if(i){if(i.mode===Ye&&o===Ge){if(!a)throw new wt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&s.forEach(function(t){if(i&&-1===i.storeNames.indexOf(t)){if(!a)throw new wt.SubTransaction("Table "+t+" not included in parent transaction.");i=null}}),a&&i&&!i.active&&(i=null)}}catch(l){return i?i._promise(null,function(t,e){e(l)}):qe(l)}var u=Yn.bind(null,this,o,s,i,n);return i?i._promise(o,u,"lock"):Gt.trans?Ce(Gt.transless,function(){return r._whenReady(u)}):this._whenReady(u)},t.prototype.table=function(t){if(!S(this._allTables,t))throw new wt.InvalidTable("Table "+t+" does not exist");return this._allTables[t]},t}(),tr=Zn;D(tr,b(b({},xt),{delete:function(t){return new tr(t).delete()},exists:function(t){return new tr(t,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){return Vn?Vn.getDatabaseNames().then(t):te.resolve([])},defineClass:function(){return function(t){O(this,t)}},ignoreTransaction:function(t){return Gt.trans?Ce(Gt.transless,t):t()},vip:Un,async:function(t){return function(){try{var e=Jn(t.apply(this,arguments));return e&&"function"==typeof e.then?e:te.resolve(e)}catch(n){return qe(n)}}},spawn:function(t,e,n){try{var r=Jn(t.apply(n,e||[]));return r&&"function"==typeof r.then?r:te.resolve(r)}catch(i){return qe(i)}},currentTransaction:{get:function(){return Gt.trans||null}},waitFor:function(t,e){var n=te.resolve("function"==typeof t?tr.ignoreTransaction(t):t).timeout(e||6e4);return Gt.trans?Gt.trans.waitFor(n):n},Promise:te,debug:{get:function(){return ot},set:function(t){st(t,"dexie"===t?function(){return!0}:Je)}},derive:j,extend:O,props:D,override:q,Events:en,getByKeyPath:R,setByKeyPath:z,delByKeyPath:$,shallowClone:L,deepClone:Y,getObjectDiff:Z,asap:K,minKey:Re,addons:[],connections:Le,errnames:gt,dependencies:function(){try{return{indexedDB:k.indexedDB||k.mozIndexedDB||k.webkitIndexedDB||k.msIndexedDB,IDBKeyRange:k.IDBKeyRange||k.webkitIDBKeyRange}}catch(t){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:Ke,version:Ke.split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,2*n)}),default:tr,Dexie:tr})),tr.maxKey=xn(tr.dependencies.IDBKeyRange),function(t){try{Vn=function(t){var e,n=t&&"function"==typeof t.databases;if(!n){var r=new Zn(He,{addons:[]});r.version(1).stores({dbnames:"name"}),e=r.table("dbnames")}return{getDatabaseNames:function(){return n?te.resolve(t.databases()).then(function(t){return t.map(function(t){return t.name}).filter(function(t){return t!==He})}):e.toCollection().primaryKeys()},add:function(t){return!n&&t!==He&&e.put({name:t}).catch(kt)},remove:function(t){return!n&&t!==He&&e.delete(t).catch(kt)}}}(t)}catch(e){}}(Zn.dependencies.indexedDB),te.rejectionMapper=function(t,e){if(!t||t instanceof pt||t instanceof TypeError||t instanceof SyntaxError||!t.name||!It[t.name])return t;var n=new It[t.name](e||t.message,t);return"stack"in t&&C(n,"stack",{get:function(){return this.inner.stack}}),n},st(ot,Je);var er=Zn,nr=n("XS3J");addEventListener("message",({data:t})=>{var e;"write"===t.action?(e=t.payload,"loki"===e.db?new Promise((t,n)=>{t(function(t){const e=Date.now();let n=0;sr=new nr("Loki-test");const r=sr.addCollection("test");for(let i=0;i<t;i++)r.insert([{name:"Thor",age:Math.random()}]);return n=Date.now()-e,n}(e.numberOfQuerys))}):"idb"===e.db?function(t){const e=Date.now();return new Promise((n,r)=>{for(let e=0;e<t;e++)or.put("idb-test",Math.random(),Math.random().toString());n(Date.now()-e)})}(e.numberOfQuerys):"dexie"===e.db?function(t){ir=new rr;const e=Date.now();return new Promise((n,i)=>{for(let e=0;e<t;e++)ir.transaction("rw",ir.friends,()=>r(this,void 0,void 0,function*(){ir.friends.add({name:"Jafar",age:21})}));n(Date.now()-e)})}(e.numberOfQuerys):new Promise((t,e)=>{e("ls is not available in worker")})).then(t=>{postMessage({response:t,status:!0})}).catch(t=>{postMessage({response:t,status:!1})}):postMessage({response:"Error in input",status:!1})});class rr extends er{constructor(){super("Dexie"),this.version(1).stores({friends:"++id,name,age"})}}let ir=new rr;!function(){r(this,void 0,void 0,function*(){or=yield function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const s=indexedDB.open(t,e),a=f(s);return r&&s.addEventListener("upgradeneeded",t=>{r(f(s.result),t.oldVersion,t.newVersion,f(s.transaction))}),n&&s.addEventListener("blocked",()=>n()),a.then(t=>{o&&t.addEventListener("close",()=>o()),i&&t.addEventListener("versionchange",()=>i())}).catch(()=>{}),a}("my-db",1,{upgrade(t){t.createObjectStore("idb-test")}})})}();let or,sr=new nr("Loki-test")},XS3J:function(t,e,n){var r,i;void 0===(i="function"==typeof(r=function(){return function(){"use strict";var t=Object.prototype.hasOwnProperty;function e(t){var n,i;if(Array.isArray(t)){for(i=0;i<t.length;i++)e(t[i]);r(t)}else if(null!==t&&"object"==typeof t){for(n in t)t.hasOwnProperty(n)&&e(t[n]);r(t)}}function r(t){Object.isFrozen(t)||Object.freeze(t)}function i(t){return Object.isFrozen(t)?v(t,"shallow"):t}var o={copyProperties:function(t,e){var n;for(n in t)e[n]=t[n]},resolveTransformObject:function(t,e,n){var r,i;if("number"!=typeof n&&(n=0),++n>=10)return t;for(r in t)"string"==typeof t[r]&&0===t[r].indexOf("[%lktxp]")?(i=t[r].substring(8),e.hasOwnProperty(i)&&(t[r]=e[i])):"object"==typeof t[r]&&(t[r]=o.resolveTransformObject(t[r],e,n));return t},resolveTransformParams:function(t,e){var n,r,i=[];if(void 0===e)return t;for(n=0;n<t.length;n++)r=v(t[n],"shallow-recurse-objects"),i.push(o.resolveTransformObject(r,e));return i},getIn:function(t,e,n){if(null!=t){if(!n)return t[e];if("string"==typeof e&&(e=e.split(".")),!Array.isArray(e))throw new Error("path must be a string or array. Found "+typeof e);for(var r=0,i=e.length;null!=t&&r<i;)t=t[e[r++]];return r&&r==i?t:void 0}}},s={aeq:a,lt:u,gt:l};function a(t,e){var n,r,i,o;if(t===e)return!0;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:i=1;break;case!1:i=3;break;case!0:i=4;break;case"":i=5;break;default:i=t==t?9:0}switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}if(9!==i||9!==o)return i===o}return n=Number(t),r=Number(e),n==n||r==r?n===r:(n=t.toString())==(r=e.toString())}function u(t,e,n){var r,i,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?n:o<s}return r=Number(t),i=Number(e),r==r&&i==i?r<i||!(r>i)&&n:r==r&&i!=i||(i!=i||r==r)&&(t<e||!(t>e)&&(t==e?n:(r=t.toString())<(i=e.toString())||r==i&&n))}function l(t,e,n){var r,i,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?n:o>s}return r=Number(t),i=Number(e),r==r&&i==i?r>i||!(r<i)&&n:(r!=r||i==i)&&(i==i&&r!=r||t>e||!(t<e)&&(t==e?n:(r=t.toString())>(i=e.toString())||r==i&&n))}function c(t,e,n){return s.aeq(t,e)?0:s.lt(t,e,!1)?n?1:-1:s.gt(t,e,!1)?n?-1:1:0}function h(t,e,n,r,i,o){var s,a=o||0,u=e[a],l=!1;if("object"==typeof t&&u in t&&(s=t[u]),a+1>=e.length)l=n(s,r,i);else if(Array.isArray(s))for(var c=0,f=s.length;c<f&&!0!==(l=h(s[c],e,n,r,i,a+1));c+=1);else l=h(s,e,n,r,i,a+1);return l}function f(e){return"string"==typeof e||Array.isArray(e)?function(t){return-1!==e.indexOf(t)}:"object"==typeof e&&null!==e?function(n){return t.call(e,n)}:null}function d(e,n,r){for(var i in n)if(t.call(n,i))return p[i](e,n[i],r);return!1}var p={$eq:function(t,e){return t===e},$aeq:function(t,e){return t==e},$ne:function(t,e){return e!=e?t==t:t!==e},$dteq:function(t,e){return s.aeq(t,e)},$gt:function(t,e){return s.gt(t,e,!1)},$gte:function(t,e){return s.gt(t,e,!0)},$lt:function(t,e){return s.lt(t,e,!1)},$lte:function(t,e){return s.lt(t,e,!0)},$jgt:function(t,e){return t>e},$jgte:function(t,e){return t>=e},$jlt:function(t,e){return t<e},$jlte:function(t,e){return t<=e},$between:function(t,e){return null!=t&&s.gt(t,e[0],!0)&&s.lt(t,e[1],!0)},$jbetween:function(t,e){return null!=t&&t>=e[0]&&t<=e[1]},$in:function(t,e){return-1!==e.indexOf(t)},$inSet:function(t,e){return e.has(t)},$nin:function(t,e){return-1===e.indexOf(t)},$keyin:function(t,e){return t in e},$nkeyin:function(t,e){return!(t in e)},$definedin:function(t,e){return void 0!==e[t]},$undefinedin:function(t,e){return void 0===e[t]},$regex:function(t,e){return e.test(t)},$containsString:function(t,e){return"string"==typeof t&&-1!==t.indexOf(e)},$containsNone:function(t,e){return!p.$containsAny(t,e)},$containsAny:function(t,e){var n=f(t);return null!==n&&(Array.isArray(e)?e.some(n):n(e))},$contains:function(t,e){var n=f(t);return null!==n&&(Array.isArray(e)?e.every(n):n(e))},$elemMatch:function(t,e){return!!Array.isArray(t)&&t.some(function(t){return Object.keys(e).every(function(n){var r=e[n];return"object"==typeof r&&r||(r={$eq:r}),-1!==n.indexOf(".")?h(t,n.split("."),d,e[n],t):d(t[n],r,t)})})},$type:function(t,e,n){var r=typeof t;return"object"===r&&(Array.isArray(t)?r="array":t instanceof Date&&(r="date")),"object"!=typeof e?r===e:d(r,e,n)},$finite:function(t,e){return e===isFinite(t)},$size:function(t,e,n){return!!Array.isArray(t)&&("object"!=typeof e?t.length===e:d(t.length,e,n))},$len:function(t,e,n){return"string"==typeof t&&("object"!=typeof e?t.length===e:d(t.length,e,n))},$where:function(t,e){return!0===e(t)},$not:function(t,e,n){return!d(t,e,n)},$and:function(t,e,n){for(var r=0,i=e.length;r<i;r+=1)if(!d(t,e[r],n))return!1;return!0},$or:function(t,e,n){for(var r=0,i=e.length;r<i;r+=1)if(d(t,e[r],n))return!0;return!1},$exists:function(t,e){return e?void 0!==t:void 0===t}};["$eq","$aeq","$ne","$dteq","$gt","$gte","$lt","$lte","$jgt","$jgte","$jlt","$jlte","$type"].forEach(function(t){var e=p[t];p["$"+t]=function(t,n,r){if("string"==typeof n)return e(t,r[n]);if("function"==typeof n)return e(t,n(r));throw new Error("Invalid argument to $$ matcher")}});var y={$eq:p.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};function v(t,e){if(null==t)return null;var n;switch(e||"parse-stringify"){case"parse-stringify":n=JSON.parse(JSON.stringify(t));break;case"jquery-extend-deep":n=jQuery.extend(!0,{},t);break;case"shallow":n=Object.create(t.constructor.prototype),Object.keys(t).map(function(e){n[e]=t[e]});break;case"shallow-assign":n=Object.create(t.constructor.prototype),Object.assign(n,t);break;case"shallow-recurse-objects":n=v(t,"shallow"),Object.keys(t).forEach(function(e){"object"==typeof t[e]&&"Object"===t[e].constructor.name?n[e]=v(t[e],"shallow-recurse-objects"):Array.isArray(t[e])&&(n[e]=function(t,e){for(var n=[],r=0,i=t.length;r<i;r++)n[r]=v(t[r],e);return n}(t[e],"shallow-recurse-objects"))})}return n}function m(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch(t){return!1}}function g(){}function b(t,e){this.filename=t||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!e||!e.hasOwnProperty("verbose"))&&e.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]},this.ENV=e&&e.hasOwnProperty("env")?e.env:"undefined"!=typeof global&&(global.android||global.NSObject)?"NATIVESCRIPT":"undefined"==typeof window||"undefined"!=typeof global&&global.window&&"undefined"!=typeof process?"NODEJS":"undefined"!=typeof document?-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER":"CORDOVA","undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(e,!0),this.on("init",this.clearChanges)}function w(t){this.hashStore={},this.options=t||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function I(t,e){if(this.mode="reference",this.adapter=null,this.options=e||{},this.dbref=null,this.dbname="",this.pageIterator={},!t)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===t.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=t,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function x(){try{this.fs=n(!function(){var t=new Error("Cannot find module 'fs'");throw t.code="MODULE_NOT_FOUND",t}())}catch(t){this.fs=null}}function k(){}function O(t,e){return e=e||{},this.collection=t,this.filteredrows=[],this.filterInitialized=!1,this}function _(t,e){if("$regex"===t)Array.isArray(e)?e=new RegExp(e[0],e[1]):e instanceof RegExp||(e=new RegExp(e));else if("object"==typeof e)for(var n in e)"$regex"!==n&&"object"!=typeof e[n]||(e[n]=_(n,e[n]));return e}function P(t,e,n){this.collection=t,this.name=e,this.rebuildPending=!1,this.options=n||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new O(t),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.collection.disableFreeze||Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[],filter:[],sort:[]}}function S(e,n){this.name=e,this.data=[],this.idIndex=null,this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var r=this;(n=n||{}).hasOwnProperty("unique")&&(Array.isArray(n.unique)||(n.unique=[n.unique]),n.unique.forEach(function(t){r.uniqueNames.push(t)})),n.hasOwnProperty("exact")&&n.exact.forEach(function(t){r.constraints.exact[t]=new K(t)}),this.adaptiveBinaryIndices=!n.hasOwnProperty("adaptiveBinaryIndices")||n.adaptiveBinaryIndices,this.transactional=!!n.hasOwnProperty("transactional")&&n.transactional,this.cloneObjects=!!n.hasOwnProperty("clone")&&n.clone,this.cloneMethod=n.hasOwnProperty("cloneMethod")?n.cloneMethod:"parse-stringify",this.asyncListeners=!!n.hasOwnProperty("asyncListeners")&&n.asyncListeners,this.disableMeta=!!n.hasOwnProperty("disableMeta")&&n.disableMeta,this.disableChangesApi=!n.hasOwnProperty("disableChangesApi")||n.disableChangesApi,this.disableDeltaChangesApi=!n.hasOwnProperty("disableDeltaChangesApi")||n.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!n.hasOwnProperty("autoupdate")&&n.autoupdate,this.serializableIndices=!n.hasOwnProperty("serializableIndices")||n.serializableIndices,this.disableFreeze=!n.hasOwnProperty("disableFreeze")||n.disableFreeze,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(n.ttl||-1,n.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.dirtyIds=[];var i=[];if(n&&n.indices)if("[object Array]"===Object.prototype.toString.call(n.indices))i=n.indices;else{if("string"!=typeof n.indices)throw new TypeError("Indices needs to be a string or an array of strings");i=[n.indices]}for(var o=0;o<i.length;o++)this.ensureIndex(i[o]);function s(t,e){var n=null!==e&&"object"==typeof e?Object.keys(e):null;if(n&&n.length&&["string","boolean","number"].indexOf(typeof e)<0){for(var i={},o=0;o<n.length;o++){var a=n[o];if(e.hasOwnProperty(a))if(!t.hasOwnProperty(a)||r.uniqueNames.indexOf(a)>=0||"$loki"==a||"meta"==a)i[a]=e[a];else{var u=s(t[a],e[a]);void 0!==u&&u!={}&&(i[a]=u)}}return 0===Object.keys(i).length?void 0:i}return t===e?void 0:e}function a(){r.changes=[]}this.observerCallback=function(e){var n="function"==typeof Set?new Set:[];n.add||(n.add=function(t){return-1===this.indexOf(t)&&this.push(t),this}),e.forEach(function(t){n.add(t.object)}),n.forEach(function(e){if(!t.call(e,"$loki"))return r.removeAutoUpdateObserver(e);try{r.update(e)}catch(n){}})},this.getChangeDelta=function(t,e){return e?s(e,t):JSON.parse(JSON.stringify(t))},this.getObjectDelta=s,this.getChanges=function(){return r.changes},this.flushChanges=a,this.setChangesApi=function(t){r.disableChangesApi=!t,t||(r.disableDeltaChangesApi=!1)},this.on("delete",function(t){r.disableChangesApi||r.createChange(r.name,"R",t)}),this.on("warning",function(t){r.lokiConsoleWrapper.warn(t)}),a()}function D(t){return-1!==t.indexOf(".")}function A(t){return parseFloat(t,10)}function C(t,e){return t+e}function j(t,e){return t-e}function E(t){return t.reduce(C,0)/t.length}function F(t,e,n){if(!1===n)return t[e];for(var r=e.split("."),i=t;r.length>0;)i=i[r.shift()];return i}function M(t,e,n){for(var r,i,o=0,s=t.length;o<s;){if(0===(r=n.apply(null,[e,t[i=o+s>>1]])))return{found:!0,index:i};r<0?s=i:o=i+1}return{found:!1,index:s}}function B(t){return function(e,n){return M(e,n,t)}}function q(){}function N(t){this.field=t,this.keyMap=Object.create(null),this.lokiMap=Object.create(null)}function K(t){this.index=Object.create(null),this.field=t}return g.prototype.events={},g.prototype.asyncListeners=!1,g.prototype.on=function(t,e){var n,r=this;return Array.isArray(t)?(t.forEach(function(t){r.on(t,e)}),e):((n=this.events[t])||(n=this.events[t]=[]),n.push(e),e)},g.prototype.emit=function(t){var e,n=this;if(!t||!this.events[t])throw new Error("No event "+t+" defined");this.events[t].length&&(e=Array.prototype.slice.call(arguments,1),this.events[t].forEach(function(t){n.asyncListeners?setTimeout(function(){t.apply(n,e)},1):t.apply(n,e)}))},g.prototype.addListener=g.prototype.on,g.prototype.removeListener=function(t,e){var n=this;if(Array.isArray(t))t.forEach(function(t){n.removeListener(t,e)});else if(this.events[t]){var r=this.events[t];r.splice(r.indexOf(e),1)}},(b.prototype=new g).constructor=b,b.prototype.getIndexedAdapter=function(){return n("pnzC")},b.prototype.configureOptions=function(t,e){var n={fs:x,localStorage:k,memory:w};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,void 0!==t){if(this.options=t,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof n[t.persistenceMethod]&&(this.persistenceMethod=t.persistenceMethod,this.persistenceAdapter=new n[t.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=t.adapter,this.options.adapter=null,this.isIncremental="incremental"===this.persistenceAdapter.mode),t.autoload&&e){var r=this;setTimeout(function(){r.loadDatabase(t,t.autoloadCallback)},1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(t,t.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)}this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"}[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new n[this.persistenceMethod]))},b.prototype.copy=function(t){var e,n,r=new b(this.filename,{env:"NA"});if(t=t||{},r.loadJSONObject(this,{retainDirtyFlags:!0}),t.hasOwnProperty("removeNonSerializable")&&!0===t.removeNonSerializable)for(r.autosaveHandle=null,r.persistenceAdapter=null,e=r.collections.length,n=0;n<e;n++)r.collections[n].constraints=null,r.collections[n].ttl=null;return r},b.prototype.addCollection=function(t,e){var n,r=this.collections.length;if(e&&!0===e.disableMeta){if(!1===e.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===e.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof e.ttl&&e.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(n=0;n<r;n+=1)if(this.collections[n].name===t)return this.collections[n];var i=new S(t,e);return i.isIncremental=this.isIncremental,this.collections.push(i),this.verbose&&(i.lokiConsoleWrapper=console),i},b.prototype.loadCollection=function(t){if(!t.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(t)},b.prototype.getCollection=function(t){var e,n=this.collections.length;for(e=0;e<n;e+=1)if(this.collections[e].name===t)return this.collections[e];return this.emit("warning","collection "+t+" not found"),null},b.prototype.renameCollection=function(t,e){var n=this.getCollection(t);return n&&(n.name=e),n},b.prototype.listCollections=function(){for(var t=this.collections.length,e=[];t--;)e.push({name:this.collections[t].name,type:this.collections[t].objType,count:this.collections[t].data.length});return e},b.prototype.removeCollection=function(t){var e,n=this.collections.length;for(e=0;e<n;e+=1)if(this.collections[e].name===t){var r=new S(t,{}),i=this.collections[e];for(var o in i)i.hasOwnProperty(o)&&r.hasOwnProperty(o)&&(i[o]=r[o]);return void this.collections.splice(e,1)}},b.prototype.getName=function(){return this.name},b.prototype.serializeReplacer=function(t,e){switch(t){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":return null;case"throttledSavePending":case"throttledCallbacks":return;case"lokiConsoleWrapper":return null;default:return e}},b.prototype.toJson=b.prototype.serialize=function(t){switch((t=t||{}).hasOwnProperty("serializationMethod")||(t.serializationMethod=this.options.serializationMethod),t.serializationMethod){case"normal":return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured();default:return JSON.stringify(this,this.serializeReplacer)}},b.prototype.serializeDestructured=function(t){var e,n,r,i,o,s=[];if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),!0===t.partitioned&&t.hasOwnProperty("partition")&&t.partition>=0)return this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:t.partition});for((o=new b(this.filename)).loadJSONObject(this),e=0;e<o.collections.length;e++)o.collections[e].data=[];if(!0===t.partitioned&&-1===t.partition)return o.serialize({serializationMethod:"normal"});for(s.push(o.serialize({serializationMethod:"normal"})),o=null,e=0;e<this.collections.length;e++)if(r=this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:e}),!1===t.partitioned&&!1===t.delimited){if(!Array.isArray(r))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(i=r.length,n=0;n<i;n++)s.push(r[n]),r[n]=null;s.push("")}else s.push(r);return t.partitioned?s:t.delimited?(s.push(""),s.join(t.delimiter)):(s.push(""),s)},b.prototype.serializeCollection=function(t){var e,n,r=[];if((t=t||{}).hasOwnProperty("delimited")||(t.delimited=!0),!t.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(e=this.collections[t.collectionIndex].data.length,r=[],n=0;n<e;n++)r.push(JSON.stringify(this.collections[t.collectionIndex].data[n]));return t.delimited?(r.push(""),r.join(t.delimiter)):r},b.prototype.deserializeDestructured=function(t,e){var n,r,i,o=[],s=0,a=1,u=!1;if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.partitioned){if(e.hasOwnProperty("partition"))return-1===e.partition?n=JSON.parse(t[0]):this.deserializeCollection(t[e.partition+1],e);for(r=(n=JSON.parse(t[0])).collections.length,s=0;s<r;s++)n.collections[s].data=this.deserializeCollection(t[s+1],e);return n}if(e.delimited){if(o=t.split(e.delimiter),t=null,0===o.length)return null}else o=t;for(r=(n=JSON.parse(o[0])).collections.length,o[0]=null;!u;)""===o[a]?++s>r&&(u=!0):(i=JSON.parse(o[a]),n.collections[s].data.push(i)),o[a++]=null;return n},b.prototype.deserializeCollection=function(t,e){var n,r,i=[];for((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.delimited?(i=t.split(e.delimiter)).pop():i=t,r=i.length,n=0;n<r;n++)i[n]=JSON.parse(i[n]);return i},b.prototype.loadJSON=function(t,e){var n;if(0===t.length)n={};else switch(this.options.serializationMethod){case"normal":case"pretty":n=JSON.parse(t);break;case"destructured":n=this.deserializeDestructured(t);break;default:n=JSON.parse(t)}this.loadJSONObject(n,e)},b.prototype.loadJSONObject=function(t,n){var r,i,s,a,u,l,c=0,h=t.collections?t.collections.length:0;function f(t){var e,r=n[t.name];return r.proto?(e=r.inflate||o.copyProperties,function(t){var n=new r.proto;return e(t,n),n}):r.inflate}for(this.name=t.name,t.hasOwnProperty("throttledSaves")&&n&&!n.hasOwnProperty("throttledSaves")&&(this.throttledSaves=t.throttledSaves),this.collections=[];c<h;c+=1){if((i=this.addCollection((r=t.collections[c]).name,{disableChangesApi:r.disableChangesApi,disableDeltaChangesApi:r.disableDeltaChangesApi,disableMeta:r.disableMeta,disableFreeze:!r.hasOwnProperty("disableFreeze")||r.disableFreeze})).adaptiveBinaryIndices=!!r.hasOwnProperty("adaptiveBinaryIndices")&&!0===r.adaptiveBinaryIndices,i.transactional=r.transactional,i.asyncListeners=r.asyncListeners,i.cloneObjects=r.cloneObjects,i.cloneMethod=r.cloneMethod||"parse-stringify",i.autoupdate=r.autoupdate,i.changes=r.changes,i.dirtyIds=r.dirtyIds||[],i.dirty=!(!n||!0!==n.retainDirtyFlags)&&r.dirty,s=r.data.length,a=0,n&&n.hasOwnProperty(r.name))for(u=f(r);a<s;a++)l=u(r.data[a]),i.data[a]=l,i.addAutoUpdateObserver(l),i.disableFreeze||e(i.data[a]);else for(;a<s;a++)i.data[a]=r.data[a],i.addAutoUpdateObserver(i.data[a]),i.disableFreeze||e(i.data[a]);if(i.maxId=void 0===r.maxId?0:r.maxId,void 0!==r.binaryIndices&&(i.binaryIndices=r.binaryIndices),void 0!==r.transforms&&(i.transforms=r.transforms),i.uniqueNames=[],r.hasOwnProperty("uniqueNames")&&(i.uniqueNames=r.uniqueNames),void 0!==r.DynamicViews){for(var d=0;d<r.DynamicViews.length;d++){var p=r.DynamicViews[d],y=i.addDynamicView(p.name,p.options);y.resultdata=p.resultdata,y.resultsdirty=p.resultsdirty,y.filterPipeline=p.filterPipeline,y.sortCriteriaSimple=p.sortCriteriaSimple,y.sortCriteria=p.sortCriteria,y.sortFunction=null,y.sortDirty=p.sortDirty,i.disableFreeze||(e(y.filterPipeline),y.sortCriteriaSimple?e(y.sortCriteriaSimple):y.sortCriteria&&e(y.sortCriteria)),y.resultset.filteredrows=p.resultset.filteredrows,y.resultset.filterInitialized=p.resultset.filterInitialized,y.rematerialize({removeWhereFilters:!0})}t.databaseVersion<1.5&&(i.ensureAllIndexes(!0),i.dirty=!0)}}},b.prototype.close=function(t){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(t),t=void 0)),t&&this.on("close",t),this.emit("close")},b.prototype.generateChangesNotification=function(t){function e(t){return t.name}var n=[],r=t||this.collections.map(e);return this.collections.forEach(function(t){-1!==r.indexOf(e(t))&&(n=n.concat(t.getChanges()))}),n},b.prototype.serializeChanges=function(t){return JSON.stringify(this.generateChangesNotification(t))},b.prototype.clearChanges=function(){this.collections.forEach(function(t){t.flushChanges&&t.flushChanges()})},w.prototype.loadDatabase=function(t,e){var n=this;this.options.asyncResponses?setTimeout(function(){n.hashStore.hasOwnProperty(t)?e(n.hashStore[t].value):e(null)},this.options.asyncTimeout):this.hashStore.hasOwnProperty(t)?e(this.hashStore[t].value):e(null)},w.prototype.saveDatabase=function(t,e,n){var r,i=this;this.options.asyncResponses?setTimeout(function(){r=i.hashStore.hasOwnProperty(t)?i.hashStore[t].savecount:0,i.hashStore[t]={savecount:r+1,lastsave:new Date,value:e},n()},this.options.asyncTimeout):(r=this.hashStore.hasOwnProperty(t)?this.hashStore[t].savecount:0,this.hashStore[t]={savecount:r+1,lastsave:new Date,value:e},n())},w.prototype.deleteDatabase=function(t,e){this.hashStore.hasOwnProperty(t)&&delete this.hashStore[t],"function"==typeof e&&e()},I.prototype.loadDatabase=function(t,e){var n=this;this.dbname=t,this.dbref=new b(t),this.adapter.loadDatabase(t,function(t){if(t){"string"!=typeof t&&e(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()"));var r=JSON.parse(t);n.dbref.loadJSONObject(r),r=null,0!==n.dbref.collections.length?(n.pageIterator={collection:0,pageIndex:0},n.loadNextPartition(0,function(){e(n.dbref)})):e(n.dbref)}else e(t)})},I.prototype.loadNextPartition=function(t,e){var n=this.dbname+"."+t,r=this;if(!0===this.options.paging)return this.pageIterator.pageIndex=0,void this.loadNextPage(e);this.adapter.loadDatabase(n,function(n){var i=r.dbref.deserializeCollection(n,{delimited:!0,collectionIndex:t});r.dbref.collections[t].data=i,++t<r.dbref.collections.length?r.loadNextPartition(t,e):e()})},I.prototype.loadNextPage=function(t){var e=this;this.adapter.loadDatabase(this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,function(n){var r=n.split(e.options.delimiter);n="";var i,o=r.length,s=""===r[o-1];for(s&&(r.pop(),""===r[(o=r.length)-1]&&1===o&&(r.pop(),o=r.length)),i=0;i<o;i++)e.dbref.collections[e.pageIterator.collection].data.push(JSON.parse(r[i])),r[i]=null;r=[],s?++e.pageIterator.collection<e.dbref.collections.length?e.loadNextPartition(e.pageIterator.collection,t):t():(e.pageIterator.pageIndex++,e.loadNextPage(t))})},I.prototype.exportDatabase=function(t,e,n){var r,i=e.collections.length;for(this.dbref=e,this.dbname=t,this.dirtyPartitions=[-1],r=0;r<i;r++)e.collections[r].dirty&&this.dirtyPartitions.push(r);this.saveNextPartition(function(t){n(t)})},I.prototype.saveNextPartition=function(t){var e=this,n=this.dirtyPartitions.shift(),r=this.dbname+(-1===n?"":"."+n);if(this.options.paging&&-1!==n)return this.pageIterator={collection:n,docIndex:0,pageIndex:0},void this.saveNextPage(function(n){0===e.dirtyPartitions.length?t(n):e.saveNextPartition(t)});var i=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:n});this.adapter.saveDatabase(r,i,function(n){n?t(n):0===e.dirtyPartitions.length?t(null):e.saveNextPartition(t)})},I.prototype.saveNextPage=function(t){var e=this,n=this.dbref.collections[this.pageIterator.collection],r=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,i=0,o=n.data.length,s=this.options.delimiter.length,a="",u="",l=!1,c=!1,h=function(n){u="",n&&t(n),l?t(null):(e.pageIterator.pageIndex++,e.saveNextPage(t))};for(0===n.data.length&&(l=!0);;)if(l||(a=JSON.stringify(n.data[this.pageIterator.docIndex]),u+=a,i+=a.length,++this.pageIterator.docIndex>=o&&(l=!0)),i>=this.options.pageSize&&(c=!0),c&&!l||(u+=this.options.delimiter,i+=s),l||c)return void this.adapter.saveDatabase(r,u,h)},x.prototype.loadDatabase=function(t,e){var n=this;this.fs.stat(t,function(r,i){!r&&i.isFile()?n.fs.readFile(t,{encoding:"utf8"},function(t,n){e(t?new Error(t):n)}):e(null)})},x.prototype.saveDatabase=function(t,e,n){var r=this,i=t+"~";this.fs.writeFile(i,e,function(e){e?n(new Error(e)):r.fs.rename(i,t,n)})},x.prototype.deleteDatabase=function(t,e){this.fs.unlink(t,function(t){t?e(new Error(t)):e()})},k.prototype.loadDatabase=function(t,e){m()?e(localStorage.getItem(t)):e(new Error("localStorage is not available"))},k.prototype.saveDatabase=function(t,e,n){m()?(localStorage.setItem(t,e),n(null)):n(new Error("localStorage is not available"))},k.prototype.deleteDatabase=function(t,e){m()?(localStorage.removeItem(t),e(null)):e(new Error("localStorage is not available"))},b.prototype.throttledSaveDrain=function(t,e){var n=this,r=(new Date).getTime();if(this.throttledSaves||t(!0),(e=e||{}).hasOwnProperty("recursiveWait")||(e.recursiveWait=!0),e.hasOwnProperty("recursiveWaitLimit")||(e.recursiveWaitLimit=!1),e.hasOwnProperty("recursiveWaitLimitDuration")||(e.recursiveWaitLimitDuration=2e3),e.hasOwnProperty("started")||(e.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending){if(!e.recursiveWait)return void this.throttledCallbacks.push(t);this.throttledCallbacks.push(function(){return n.throttledSavePending?e.recursiveWaitLimit&&r-e.started>e.recursiveWaitLimitDuration?void t(!1):void n.throttledSaveDrain(t,e):void t(!0)})}else t(!0)},b.prototype.loadDatabaseInternal=function(t,e){var n=e||function(t,e){if(t)throw t},r=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,function(e){if("string"==typeof e){var i=!1;try{r.loadJSON(e,t||{}),i=!0}catch(o){n(o)}i&&(n(null),r.emit("loaded","database "+r.filename+" loaded"))}else{if(!e)return n(null),void r.emit("loaded","empty database "+r.filename+" loaded");if(e instanceof Error)return void n(e);if("object"==typeof e)return r.loadJSONObject(e,t||{}),n(null),void r.emit("loaded","database "+r.filename+" loaded");n("unexpected adapter response : "+e)}}):n(new Error("persistenceAdapter not configured"))},b.prototype.loadDatabase=function(t,e){var n=this;this.throttledSaves?this.throttledSaveDrain(function(r){if(r)return n.throttledSavePending=!0,void n.loadDatabaseInternal(t,function(t){0===n.throttledCallbacks.length?n.throttledSavePending=!1:n.saveDatabase(),"function"==typeof e&&e(t)});"function"==typeof e&&e(new Error("Unable to pause save throttling long enough to read database"))},t):this.loadDatabaseInternal(t,e)},b.prototype.saveDatabaseInternal=function(t){var e,n=t||function(t){if(t)throw t},r=this;this.persistenceAdapter?"incremental"===this.persistenceAdapter.mode?(this.ignoreAutosave=!0,this.persistenceAdapter.saveDatabase(this.filename,function(){if(r.ignoreAutosave=!1,!e){var t=r.copy({removeNonSerializable:!0});return e=r.collections.map(function(t){return[t.dirty,t.dirtyIds]}),r.collections.forEach(function(t){t.dirty=!1,t.dirtyIds=[]}),t}n(new Error("adapter error - getLokiCopy called more than once"))},function(t){r.ignoreAutosave=!1,t&&e&&r.collections.forEach(function(t,n){var r=e[n];t.dirty=t.dirty||r[0],t.dirtyIds=t.dirtyIds.concat(r[1])}),n(t)})):"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),function(t){r.autosaveClearFlags(),n(t)}):(this.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,this.serialize(),function(t){n(t)})):n(new Error("persistenceAdapter not configured"))},b.prototype.save=b.prototype.saveDatabase=function(t){if(this.throttledSaves)if(this.throttledSavePending)this.throttledCallbacks.push(t);else{var e=this.throttledCallbacks;this.throttledCallbacks=[],e.unshift(t),this.throttledSavePending=!0;var n=this;this.saveDatabaseInternal(function(t){n.throttledSavePending=!1,e.forEach(function(e){"function"==typeof e&&setTimeout(function(){e(t)},1)}),n.throttledCallbacks.length>0&&n.saveDatabase()})}else this.saveDatabaseInternal(t)},b.prototype.deleteDatabase=function(t,e){var n=e||function(t,e){if(t)throw t};"function"!=typeof t||e||(n=t),null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,function(t){n(t)}):n(new Error("persistenceAdapter not configured"))},b.prototype.autosaveDirty=function(){for(var t=0;t<this.collections.length;t++)if(this.collections[t].dirty)return!0;return!1},b.prototype.autosaveClearFlags=function(){for(var t=0;t<this.collections.length;t++)this.collections[t].dirty=!1},b.prototype.autosaveEnable=function(t,e){this.autosave=!0;var n=5e3,r=this;null!=this.autosaveInterval&&(n=this.autosaveInterval),this.autosaveHandle=setInterval(function(){r.autosaveDirty()&&!r.ignoreAutosave&&r.saveDatabase(e)},n)},b.prototype.autosaveDisable=function(){null!=this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},O.prototype.reset=function(){return this.filteredrows.length>0&&(this.filteredrows=[]),this.filterInitialized=!1,this},O.prototype.toJSON=function(){var t=this.copy();return t.collection=null,t},O.prototype.limit=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new O(this.collection);return e.filteredrows=this.filteredrows.slice(0,t),e.filterInitialized=!0,e},O.prototype.offset=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new O(this.collection);return e.filteredrows=this.filteredrows.slice(t),e.filterInitialized=!0,e},O.prototype.copy=function(){var t=new O(this.collection);return this.filteredrows.length>0&&(t.filteredrows=this.filteredrows.slice()),t.filterInitialized=this.filterInitialized,t},O.prototype.branch=O.prototype.copy,O.prototype.transform=function(t,e){var n,r,i=this;if("string"==typeof t&&this.collection.transforms.hasOwnProperty(t)&&(t=this.collection.transforms[t]),"object"!=typeof t||!Array.isArray(t))throw new Error("Invalid transform");for(void 0!==e&&(t=o.resolveTransformParams(t,e)),n=0;n<t.length;n++)switch((r=t[n]).type){case"find":i.find(r.value);break;case"where":i.where(r.value);break;case"simplesort":i.simplesort(r.property,r.desc||r.options);break;case"compoundsort":i.compoundsort(r.value);break;case"sort":i.sort(r.value);break;case"limit":i=i.limit(r.value);break;case"offset":i=i.offset(r.value);break;case"map":i=i.map(r.value,r.dataOptions);break;case"eqJoin":i=i.eqJoin(r.joinData,r.leftJoinKey,r.rightJoinKey,r.mapFun,r.dataOptions);break;case"mapReduce":i=i.mapReduce(r.mapFunction,r.reduceFunction);break;case"update":i.update(r.value);break;case"remove":i.remove()}return i},O.prototype.sort=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e,n,r=(e=t,n=this.collection.data,function(t,r){return e(n[t],n[r])});return this.filteredrows.sort(r),this},O.prototype.simplesort=function(t,e){var n=10,r=this.collection.data.length,i=this.filteredrows.length,s=this.collection.binaryIndices.hasOwnProperty(t);if(void 0!==e&&!1!==e||(e={desc:!1}),!0===e&&(e={desc:!0}),0===i){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(t))return this.collection.ensureIndex(t),this.filteredrows=this.collection.binaryIndices[t].values.slice(0),e.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!e.disableIndexIntersect&&s&&(e.useJavascriptSorting&&(n=6),r/i<=n||e.forceIndexIntersect)){var a,u=this.filteredrows,l={};for(a=0;a<i;a++)l[u[a]]=!0;return this.filteredrows=this.collection.binaryIndices[t].values.filter(function(t){return l[t]}),e.desc&&this.filteredrows.reverse(),this}if(e.useJavascriptSorting)return this.sort(function(e,n){return e[t]===n[t]?0:e[t]>n[t]?1:e[t]<n[t]?-1:void 0});var h,f,d,p,y,v,m=(h=t,f=e.desc,d=this.collection.data,function(t,e){return~h.indexOf(".")?(v=h.split("."),p=o.getIn(d[t],v,!0),y=o.getIn(d[e],v,!0)):(p=d[t][h],y=d[e][h]),c(p,y,f)});return this.filteredrows.sort(m),this},O.prototype.compoundsort=function(t){if(0===t.length)throw new Error("Invalid call to compoundsort, need at least one property");var e;if(1===t.length)return e=t[0],Array.isArray(e)?this.simplesort(e[0],e[1]):this.simplesort(e,!1);for(var n=0,r=t.length;n<r;n+=1)e=t[n],Array.isArray(e)||(t[n]=[e,!1]);this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var i,s,a=(i=t,s=this.collection.data,function(t,e){return function(t,e,n){for(var r,i,s,a,u,l=0,h=0,f=t.length;h<f;h++)if(~(i=(r=t[h])[0]).indexOf(".")?(u=i.split("."),s=o.getIn(e,u,!0),a=o.getIn(n,u,!0)):(s=e[i],a=n[i]),0!==(l=c(s,a,r[1])))return l;return 0}(i,s[t],s[e])});return this.filteredrows.sort(a),this},O.prototype.$or=O.prototype.findOr=function(t){for(var e=null,n=0,r=0,i=[],o=[],s=0,a=(this.count(),0),u=t.length;a<u;a++)for(r=(e=this.branch().find(t[a]).filteredrows).length,n=0;n<r;n++)void 0===o[s=e[n]]&&(o[s]=!0,i.push(s));return this.filteredrows=i,this.filterInitialized=!0,this},O.prototype.$and=O.prototype.findAnd=function(t){for(var e=0,n=t.length;e<n;e++){if(0===this.count())return this;this.find(t[e])}return this},O.prototype.find=function(e,n){if(0===this.collection.data.length)return this.filteredrows=[],this.filterInitialized=!0,this;var r,i,s,a,u,l,c,f=e||"getAll",d=!1,v=[],m=[],g=null;if(n=n||!1,"object"==typeof f){for(r in f)(a={})[r]=f[r],m.push(a),t.call(f,r)&&(i=r,s=f[r]);if(m.length>1)return this.find({$and:m},n)}if(!i||"getAll"===f)return n&&(this.filterInitialized?this.filteredrows=this.filteredrows.slice(0,1):(this.filteredrows=this.collection.data.length>0?[0]:[],this.filterInitialized=!0)),this;if("$and"===i||"$or"===i)return this[i](s),n&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(null===s||"object"!=typeof s||s instanceof Date)u="$eq",l=s;else{if("object"!=typeof s)throw new Error("Do not know what you want to do.");for(c in s)if(t.call(s,c)){u=c,l=s[c];break}}"$regex"!==u&&"object"!=typeof l||(l=_(u,l));var b=-1!==i.indexOf(".");!this.filterInitialized&&this.collection.binaryIndices[i]&&y[u]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(i),d=!0,g=this.collection.binaryIndices[i]),!d&&"$in"===u&&Array.isArray(l)&&"undefined"!=typeof Set&&(l=new Set(l),u="$inSet");var w,I,x=p[u],k=this.collection.data,O=0,P=0,S=0;if(this.filterInitialized){if(P=(w=this.filteredrows).length,b){for(i=i.split("."),O=0;O<P;O++)if(h(I=k[S=w[O]],i,x,l,I)&&(v.push(S),n))return this.filteredrows=v,this}else for(O=0;O<P;O++)if(x((I=k[S=w[O]])[i],l,I)&&(v.push(S),n))return this.filteredrows=v,this}else if(d){var D=this.collection.calculateRange(u,i,l);if("$in"!==u){for(O=D[0];O<=D[1];O++)if(!0!==y[u]){if(y[u](o.getIn(k[g.values[O]],i,b),l)&&(v.push(g.values[O]),n))return this.filteredrows=v,this.filterInitialized=!0,this}else if(v.push(g.values[O]),n)return this.filteredrows=v,this.filterInitialized=!0,this}else for(O=0,P=D.length;O<P;O++)if(v.push(g.values[D[O]]),n)return this.filteredrows=v,this.filterInitialized=!0,this}else if(P=k.length,b){for(i=i.split("."),O=0;O<P;O++)if(h(I=k[O],i,x,l,I)&&(v.push(O),n))return this.filteredrows=v,this.filterInitialized=!0,this}else for(O=0;O<P;O++)if(x((I=k[O])[i],l,I)&&(v.push(O),n))return this.filteredrows=v,this.filterInitialized=!0,this;return this.filteredrows=v,this.filterInitialized=!0,this},O.prototype.where=function(t){var e,n=[];if("function"!=typeof t)throw new TypeError("Argument is not a stored view or a function");e=t;try{if(this.filterInitialized){for(var r=this.filteredrows.length;r--;)!0===e(this.collection.data[this.filteredrows[r]])&&n.push(this.filteredrows[r]);return this.filteredrows=n,this}for(var i=this.collection.data.length;i--;)!0===e(this.collection.data[i])&&n.push(i);return this.filteredrows=n,this.filterInitialized=!0,this}catch(o){throw o}},O.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},O.prototype.data=function(t){var e,n,r,i,o=[],s=this.collection.data;if((t=t||{}).removeMeta&&!t.forceClones&&(t.forceClones=!0,t.forceCloneMethod=t.forceCloneMethod||"shallow"),!this.collection.disableDeltaChangesApi&&this.collection.disableFreeze&&(t.forceClones=!0,t.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||t.forceClones){for(n=s.length,i=t.forceCloneMethod||this.collection.cloneMethod,r=0;r<n;r++)e=v(s[r],i),t.removeMeta&&(delete e.$loki,delete e.meta),o.push(e);return o}return s.slice()}this.filterInitialized=!0}var a=this.filteredrows;if(n=a.length,this.collection.cloneObjects||t.forceClones)for(i=t.forceCloneMethod||this.collection.cloneMethod,r=0;r<n;r++)e=v(s[a[r]],i),t.removeMeta&&(delete e.$loki,delete e.meta),o.push(e);else for(r=0;r<n;r++)o.push(s[a[r]]);return o},O.prototype.update=function(t){if("function"!=typeof t)throw new TypeError("Argument is not a function");this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());for(var e,n=this.filteredrows.length,r=this.collection.data,i=0;i<n;i++)this.disableFreeze&&!this.collection.cloneObjects&&this.collection.disableDeltaChangesApi?(t(r[this.filteredrows[i]]),this.collection.update(r[this.filteredrows[i]])):(t(e=v(r[this.filteredrows[i]],this.collection.cloneMethod)),this.collection.update(e));return this},O.prototype.remove=function(){return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},O.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(n){throw n}},O.prototype.eqJoin=function(t,e,n,r,i){var o,s,a,u,l=[],c=[],h="function"==typeof e,f="function"==typeof n,d={};if(o=(u=this.data(i)).length,t instanceof S)l=t.chain().data(i);else if(t instanceof O)l=t.data(i);else{if(!Array.isArray(t))throw new TypeError("joinData needs to be an array or result set");l=t}s=l.length;for(var p=0;p<s;p++)d[a=f?n(l[p]):l[p][n]]=l[p];r||(r=function(t,e){return{left:t,right:e}});for(var y=0;y<o;y++)a=h?e(u[y]):u[y][e],c.push(r(u[y],d[a]||{}));return this.collection=new S("joinData"),this.collection.insert(c),this.filteredrows=[],this.filterInitialized=!1,this},O.prototype.map=function(t,e){var n=this.data(e).map(t);return this.collection=new S("mappedData"),this.collection.insert(n),this.filteredrows=[],this.filterInitialized=!1,this},(P.prototype=new g).constructor=P,P.prototype.getSort=function(){return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple},P.prototype.rematerialize=function(t){var e,n,r;t=t||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new O(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0);var i=Object.isFrozen(this.filterPipeline);if(t.hasOwnProperty("removeWhereFilters"))for(i&&(this.filterPipeline=this.filterPipeline.slice()),n=e=this.filterPipeline.length;n--;)"where"===this.filterPipeline[n].type&&(n!==this.filterPipeline.length-1&&(this.filterPipeline[n]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var o=this.filterPipeline;for(this.filterPipeline=[],e=o.length,r=0;r<e;r++)this.applyFind(o[r].val,o[r].uid);return i&&Object.freeze(this.filterPipeline),this.data(),this.emit("rebuild",this),this},P.prototype.branchResultset=function(t,e){var n=this.resultset.branch();return void 0===t?n:n.transform(t,e)},P.prototype.toJSON=function(){var t=new P(this.collection,this.name,this.options);return t.resultset=this.resultset,t.resultdata=[],t.resultsdirty=!0,t.filterPipeline=this.filterPipeline,t.sortFunction=this.sortFunction,t.sortCriteria=this.sortCriteria,t.sortCriteriaSimple=this.sortCriteriaSimple||null,t.sortDirty=this.sortDirty,t.collection=null,t},P.prototype.removeFilters=function(t){t=t||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null;var e=Object.isFrozen(this.filterPipeline),n=this.filterPipeline.length>0;this.filterPipeline=[],e&&Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,!0===t.queueSortPhase&&this.queueSortPhase(),n&&this.emit("filter")},P.prototype.applySort=function(t){return this.sortFunction=t,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this.emit("sort"),this},P.prototype.applySimpleSort=function(t,n){return this.sortCriteriaSimple={propname:t,options:n||!1},this.collection.disableFreeze||e(this.sortCriteriaSimple),this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},P.prototype.applySortCriteria=function(t){return this.sortCriteria=t,this.collection.disableFreeze||e(this.sortCriteria),this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},P.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},P.prototype.commit=function(){return this.cachedresultset=null,this},P.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},P.prototype._indexOfFilterWithId=function(t){if("string"==typeof t||"number"==typeof t)for(var e=0,n=this.filterPipeline.length;e<n;e+=1)if(t===this.filterPipeline[e].uid)return e;return-1},P.prototype._addFilter=function(t){var n=Object.isFrozen(this.filterPipeline);n&&(this.filterPipeline=this.filterPipeline.slice()),this.collection.disableFreeze||e(t),this.filterPipeline.push(t),n&&Object.freeze(this.filterPipeline),this.resultset[t.type](t.val)},P.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var t=this.filterPipeline,e=Object.isFrozen(t);this.filterPipeline=[];for(var n=0,r=t.length;n<r;n+=1)this._addFilter(t[n]);return e&&Object.freeze(this.filterPipeline),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},P.prototype.applyFilter=function(t){var e=this._indexOfFilterWithId(t.uid);if(e>=0){var n=Object.isFrozen(this.filterPipeline);return n&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline[e]=t,n&&(r(t),Object.freeze(this.filterPipeline)),this.reapplyFilters()}return this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(t),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},P.prototype.applyFind=function(t,e){return this.applyFilter({type:"find",val:t,uid:e}),this},P.prototype.applyWhere=function(t,e){return this.applyFilter({type:"where",val:t,uid:e}),this},P.prototype.removeFilter=function(t){var e=this._indexOfFilterWithId(t);if(e<0)throw new Error("Dynamic view does not contain a filter with ID: "+t);var n=Object.isFrozen(this.filterPipeline);return n&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline.splice(e,1),n&&Object.freeze(this.filterPipeline),this.reapplyFilters(),this},P.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},P.prototype.data=function(t){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(t)},P.prototype.queueRebuildEvent=function(){if(!this.rebuildPending){this.rebuildPending=!0;var t=this;setTimeout(function(){t.rebuildPending&&(t.rebuildPending=!1,t.emit("rebuild",t))},this.options.minRebuildInterval)}},P.prototype.queueSortPhase=function(){if(!this.sortDirty){this.sortDirty=!0;var t=this;"active"===this.options.sortPriority?setTimeout(function(){t.performSortPhase()},this.options.minRebuildInterval):this.queueRebuildEvent()}},P.prototype.performSortPhase=function(t){(this.sortDirty||this.resultsdirty)&&(t=t||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),t.suppressRebuildEvent||this.emit("rebuild",this))},P.prototype.evaluateDocument=function(t,e){if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var n,r=this.resultset.filteredrows,i=e?-1:r.indexOf(+t),o=r.length,s=new O(this.collection);s.filteredrows=[t],s.filterInitialized=!0;for(var a=0,u=this.filterPipeline.length;a<u;a++)s[(n=this.filterPipeline[a]).type](n.val);var l=0===s.filteredrows.length?-1:0;return-1!==i||-1!==l?-1===i&&-1!==l?(r.push(t),this.options.persistent&&this.resultdata.push(this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==i&&-1===l?(i<o-1?(r.splice(i,1),this.options.persistent&&this.resultdata.splice(i,1)):(r.length=o-1,this.options.persistent&&(this.resultdata.length=o-1)),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==i&&-1!==l?(this.options.persistent&&(this.resultdata[i]=this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},P.prototype.removeDocument=function(t){var e,n,r,i={},o={},s=[],a=this.resultset,u=this.resultset.filteredrows,l=u.length;if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(Array.isArray(t)||(t=[t]),r=t.length,n=0;n<r;n++)i[t[n]]=!0;for(e=0;e<l;e++)i[u[e]]&&(o[e]=!0);Object.keys(o).length>0&&(this.resultset.filteredrows=this.resultset.filteredrows.filter(function(t,e){return!o[e]}),this.options.persistent&&(this.resultdata=this.resultdata.filter(function(t,e){return!o[e]})),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var c=function(t){return function(e){return e<a.filteredrows[t]}};for(l=a.filteredrows.length,e=0;e<l;e++)s=t.filter(c(e)),a.filteredrows[e]-=s.length},P.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(n){throw n}},(S.prototype=new g).contructor=S,S.prototype.createChange=function(t,e,n,r){this.changes.push({name:t,operation:e,obj:"U"!=e||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(n)):this.getChangeDelta(n,r)})},S.prototype.insertMeta=function(t){var e,n;if(!this.disableMeta&&t)if(Array.isArray(t))for(e=t.length,n=0;n<e;n++)t[n].hasOwnProperty("meta")||(t[n].meta={}),t[n].meta.created=(new Date).getTime(),t[n].meta.revision=0;else t.meta||(t.meta={}),t.meta.created=(new Date).getTime(),t.meta.revision=0},S.prototype.updateMeta=function(t){return this.disableMeta||!t||(this.disableFreeze||((t=i(t)).meta=i(t.meta)),t.meta.updated=(new Date).getTime(),t.meta.revision+=1),t},S.prototype.createInsertChange=function(t){this.createChange(this.name,"I",t)},S.prototype.createUpdateChange=function(t,e){this.createChange(this.name,"U",t,e)},S.prototype.insertMetaWithChange=function(t){this.insertMeta(t),this.createInsertChange(t)},S.prototype.updateMetaWithChange=function(t,e,n){return t=this.updateMeta(t,n),this.createUpdateChange(t,e),t},S.prototype.lokiConsoleWrapper={log:function(){},warn:function(){},error:function(){}},S.prototype.addAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.observe(t,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},S.prototype.removeAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.unobserve(t,this.observerCallback)},S.prototype.addTransform=function(t,e){if(this.transforms.hasOwnProperty(t))throw new Error("a transform by that name already exists");this.transforms[t]=e},S.prototype.getTransform=function(t){return this.transforms[t]},S.prototype.setTransform=function(t,e){this.transforms[t]=e},S.prototype.removeTransform=function(t){delete this.transforms[t]},S.prototype.byExample=function(t){var e,n,r;for(e in r=[],t)t.hasOwnProperty(e)&&r.push(((n={})[e]=t[e],n));return{$and:r}},S.prototype.findObject=function(t){return this.findOne(this.byExample(t))},S.prototype.findObjects=function(t){return this.find(this.byExample(t))},S.prototype.ttlDaemonFuncGen=function(){var t=this,e=this.ttl.age;return function(){var n=Date.now();t.chain().where(function(t){return e<n-(t.meta.updated||t.meta.created)}).remove()}},S.prototype.setTTL=function(t,e){t<0?clearInterval(this.ttl.daemon):(this.ttl.age=t,this.ttl.ttlInterval=e,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),e))},S.prototype.prepareFullDocIndex=function(){for(var t=this.data.length,e=new Array(t),n=0;n<t;n+=1)e[n]=n;return e},S.prototype.configureOptions=function(t){(t=t||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=t.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},S.prototype.ensureIndex=function(t,e){if(void 0===e&&(e=!1),null==t)throw new Error("Attempting to set index without an associated property");if((!this.binaryIndices[t]||e||this.binaryIndices[t].dirty)&&(!0!==this.adaptiveBinaryIndices||!this.binaryIndices.hasOwnProperty(t)||e)){var n={name:t,dirty:!0,values:this.prepareFullDocIndex()};this.binaryIndices[t]=n;var r,i,a,u,l,c=(i=this.data,l=!!~(r=t).indexOf(".")&&r.split("."),function(t,e){if(l?(a=o.getIn(i[t],l,!0),u=o.getIn(i[e],l,!0)):(a=i[t][r],u=i[e][r]),a!==u){if(s.lt(a,u,!1))return-1;if(s.gt(a,u,!1))return 1}return 0});n.values.sort(c),n.dirty=!1,this.dirty=!0}},S.prototype.checkAllIndexes=function(e){var n,r=this.binaryIndices,i=[];for(n in r)t.call(r,n)&&(this.checkIndex(n,e)||i.push(n));return i},S.prototype.checkIndex=function(t,e){(e=e||{}).randomSamplingFactor&&!1!==e.randomSampling&&(e.randomSampling=!0),e.randomSamplingFactor=e.randomSamplingFactor||.1,(e.randomSamplingFactor<0||e.randomSamplingFactor>1)&&(e.randomSamplingFactor=.1);var n,r,i,s,a,u=!0;if(!this.binaryIndices.hasOwnProperty(t))throw new Error("called checkIndex on property without an index: "+t);if(this.adaptiveBinaryIndices||this.ensureIndex(t),(s=(a=this.binaryIndices[t].values).length)!==this.data.length)return e.repair&&this.ensureIndex(t,!0),!1;if(0===s)return!0;var l=-1!==t.indexOf(".");if(1===s)u=0===a[0];else if(e.randomSampling){if(p.$lte(o.getIn(this.data[a[0]],t,l),o.getIn(this.data[a[1]],t,l))||(u=!1),p.$lte(o.getIn(this.data[a[s-2]],t,l),o.getIn(this.data[a[s-1]],t,l))||(u=!1),u)for(r=Math.floor((s-1)*e.randomSamplingFactor),n=0;n<r-1;n++)if(i=Math.floor(Math.random()*(s-1)),!p.$lte(o.getIn(this.data[a[i]],t,l),o.getIn(this.data[a[i+1]],t,l))){u=!1;break}}else for(n=0;n<s-1;n++)if(!p.$lte(o.getIn(this.data[a[n]],t,l),o.getIn(this.data[a[n+1]],t,l))){u=!1;break}return!u&&e.repair&&this.ensureIndex(t,!0),u},S.prototype.getBinaryIndexValues=function(t){var e,n=this.binaryIndices[t].values,r=[];for(e=0;e<n.length;e++)r.push(o.getIn(this.data[n[e]],t,!0));return r},S.prototype.getUniqueIndex=function(t,e){var n=this.constraints.unique[t];return!n&&e?this.ensureUniqueIndex(t):n},S.prototype.ensureUniqueIndex=function(t){var e=this.constraints.unique[t];return e||-1==this.uniqueNames.indexOf(t)&&this.uniqueNames.push(t),this.constraints.unique[t]=e=new N(t),this.data.forEach(function(t){e.set(t)}),e},S.prototype.ensureAllIndexes=function(e){var n,r=this.binaryIndices;for(n in r)t.call(r,n)&&this.ensureIndex(n,e)},S.prototype.flagBinaryIndexesDirty=function(){var e,n=this.binaryIndices;for(e in n)t.call(n,e)&&(n[e].dirty=!0)},S.prototype.flagBinaryIndexDirty=function(t){this.binaryIndices[t]&&(this.binaryIndices[t].dirty=!0)},S.prototype.count=function(t){return t?this.chain().find(t).filteredrows.length:this.data.length},S.prototype.ensureId=function(){if(!this.idIndex){for(var t=this.data,e=0,n=t.length,r=new Array(n);e<n;e++)r[e]=t[e].$loki;this.idIndex=r}},S.prototype.ensureIdAsync=function(t){this.async(function(){this.ensureId()},t)},S.prototype.addDynamicView=function(t,e){var n=new P(this,t,e);return this.DynamicViews.push(n),n},S.prototype.removeDynamicView=function(t){this.DynamicViews=this.DynamicViews.filter(function(e){return e.name!==t})},S.prototype.getDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)if(this.DynamicViews[e].name===t)return this.DynamicViews[e];return null},S.prototype.findAndUpdate=function(t,e){"function"==typeof t?this.updateWhere(t,e):this.chain().find(t).update(e)},S.prototype.findAndRemove=function(t){this.chain().find(t).remove()},S.prototype.insert=function(t,e){if(!Array.isArray(t))return this.insertOne(t);var n,r=[],i=e&&!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0;i&&(this.adaptiveBinaryIndices=!1);try{this.emit("pre-insert",t);for(var o=0,s=t.length;o<s;o++){if(!(n=this.insertOne(t[o],!0)))return;r.push(n)}}finally{i&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}return this.emit("insert",r),1===(r=this.cloneObjects?v(r,this.cloneMethod):r).length?r[0]:r},S.prototype.insertOne=function(t,n){var r,o=null;if("object"!=typeof t?o=new TypeError("Document needs to be an object"):null===t&&(o=new TypeError("Object cannot be null")),null!==o)throw this.emit("error",o),o;var s=this.cloneObjects?v(t,this.cloneMethod):t;if(this.disableFreeze||(s=i(s)),this.disableMeta||(void 0===s.meta?s.meta={revision:0,created:0}:this.disableFreeze||(s.meta=i(s.meta))),n||this.emit("pre-insert",s),this.add(s))return this.disableChangesApi?this.insertMeta(s):this.insertMetaWithChange(s),this.disableFreeze||e(s),r=this.cloneObjects?v(s,this.cloneMethod):s,n||this.emit("insert",r),this.addAutoUpdateObserver(r),r},S.prototype.clear=function(t){var e=this;t=t||{},this.data=[],this.idIndex=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,this.constraints={unique:{},exact:{}},!0===t.removeIndices?(this.binaryIndices={},this.uniqueNames=[]):Object.keys(this.binaryIndices).forEach(function(t){e.binaryIndices[t].dirty=!1,e.binaryIndices[t].values=[]})},S.prototype.update=function(n){var r,i,o;if(Array.isArray(n)){o=n.length,(r=!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0)&&(this.adaptiveBinaryIndices=!1);try{for(i=0;i<o;i+=1)this.update(n[i])}finally{r&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!t.call(n,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var s,a,u,l,c,h=this.get(n.$loki,!0),f=this;if(!h)throw new Error("Trying to update a document not in collection.");s=h[0],u=h[1],a=this.cloneObjects||!this.disableDeltaChangesApi&&this.disableFreeze?v(n,this.cloneMethod):n,this.emit("pre-update",n),this.uniqueNames.forEach(function(t){f.getUniqueIndex(t,!0).update(s,a)}),this.data[u]=a,a!==n&&this.addAutoUpdateObserver(n);for(var d=0;d<this.DynamicViews.length;d++)this.DynamicViews[d].evaluateDocument(u,!1);if(this.adaptiveBinaryIndices){var p=this.binaryIndices;for(l in p)this.adaptiveBinaryIndexUpdate(u,l)}else this.flagBinaryIndexesDirty();return this.idIndex[u]=a.$loki,this.isIncremental&&this.dirtyIds.push(a.$loki),this.commit(),this.dirty=!0,a=this.disableChangesApi?this.updateMeta(a):this.updateMetaWithChange(a,s),this.disableFreeze||e(a),c=this.cloneObjects?v(a,this.cloneMethod):a,this.emit("update",c,s),c}catch(y){throw this.rollback(),this.lokiConsoleWrapper.error(y.message),this.emit("error",y),y}}},S.prototype.add=function(t){if("object"!=typeof t)throw new TypeError("Object being added needs to be an object");if(void 0!==t.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1);var e=this.maxId;t.$loki=e,this.disableMeta||(t.meta.version=0);for(var n=0,r=this.uniqueNames.length;n<r;n++)this.getUniqueIndex(this.uniqueNames[n],!0).set(t);this.idIndex&&this.idIndex.push(e),this.isIncremental&&this.dirtyIds.push(e),this.data.push(t);var i=this.data.length-1,o=this.DynamicViews.length;for(n=0;n<o;n++)this.DynamicViews[n].evaluateDocument(i,!0);if(this.adaptiveBinaryIndices){var s=this.binaryIndices;for(var a in s)this.adaptiveBinaryIndexInsert(i,a)}else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?v(t,this.cloneMethod):t}catch(u){throw this.rollback(),this.lokiConsoleWrapper.error(u.message),this.emit("error",u),u}},S.prototype.updateWhere=function(t,e){var n,r=this.where(t),i=0;try{for(;i<r.length;i++)n=e(r[i]),this.update(n)}catch(o){this.rollback(),this.lokiConsoleWrapper.error(o.message)}},S.prototype.removeWhere=function(t){var e;"function"==typeof t?(e=this.data.filter(t),this.remove(e)):this.chain().find(t).remove()},S.prototype.removeDataOnly=function(){this.remove(this.data.slice())},S.prototype.removeBatchByPositions=function(t){var e,n,r,i,o=t.length,s={},a=Object.keys(this.binaryIndices).length,u=Object.keys(this.constraints.unique).length,l=this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0,c=this;try{for(this.startTransaction(),this.ensureId(),r=0;r<o;r++)s[this.idIndex[t[r]]]=!0;if((e=this.DynamicViews.length)>0||a>0||u>0){if(e>0)for(n=0;n<e;n++)this.DynamicViews[n].removeDocument(t);if(this.adaptiveBinaryIndices&&!l){var h,f=this.binaryIndices;for(h in f)this.adaptiveBinaryIndexRemove(t,h)}else this.flagBinaryIndexesDirty();u&&this.uniqueNames.forEach(function(e){var n=c.getUniqueIndex(e);if(n)for(r=0;r<o;r++)null!=(i=c.data[t[r]])[e]&&n.remove(i[e])})}if(!this.disableChangesApi||this.events.delete.length>1)for(r=0;r<o;r++)this.emit("delete",this.data[t[r]]);if(this.data=this.data.filter(function(t){return!s[t.$loki]}),this.isIncremental)for(r=0;r<o;r++)this.dirtyIds.push(this.idIndex[t[r]]);this.idIndex=this.idIndex.filter(function(t){return!s[t]}),this.adaptiveBinaryIndices&&l&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(d){return this.rollback(),l&&(this.adaptiveBinaryIndices=!0),this.lokiConsoleWrapper.error(d.message),this.emit("error",d),null}},S.prototype.removeBatch=function(t){var e,n=t.length,r=this.data.length,i={},o=[];for(e=0;e<r;e++)i[this.data[e].$loki]=e;for(e=0;e<n;e++)o.push("object"==typeof t[e]?i[t[e].$loki]:i[t[e]]);this.removeBatchByPositions(o)},S.prototype.remove=function(e){if("number"==typeof e&&(e=this.get(e)),"object"!=typeof e)throw new Error("Parameter is not an object");if(Array.isArray(e))this.removeBatch(e);else{if(!t.call(e,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var n=this.get(e.$loki,!0),o=n[1],s=this;this.uniqueNames.forEach(function(t){if(null!=e[t]){var n=s.getUniqueIndex(t);n&&n.remove(e[t])}});for(var a=0;a<this.DynamicViews.length;a++)this.DynamicViews[a].removeDocument(o);if(this.adaptiveBinaryIndices){var u,l=this.binaryIndices;for(u in l)this.adaptiveBinaryIndexRemove(o,u)}else this.flagBinaryIndexesDirty();return this.data.splice(o,1),this.removeAutoUpdateObserver(e),this.idIndex.splice(o,1),this.isIncremental&&this.dirtyIds.push(e.$loki),this.commit(),this.dirty=!0,this.emit("delete",n[0]),this.disableFreeze||(e=i(e)),delete e.$loki,delete e.meta,this.disableFreeze||r(e),e}catch(c){return this.rollback(),this.lokiConsoleWrapper.error(c.message),this.emit("error",c),null}}},S.prototype.get=function(t,e){this.idIndex||this.ensureId();var n=e||!1,r=this.idIndex,i=r.length-1,o=0,s=o+i>>1;if(t="number"==typeof t?t:parseInt(t,10),isNaN(t))throw new TypeError("Passed id is not an integer");for(;r[o]<r[i];)r[s=o+i>>1]<t?o=s+1:i=s;return i===o&&r[o]===t?n?[this.data[o],o]:this.data[o]:null},S.prototype.getBinaryIndexPosition=function(t,e){var n=o.getIn(this.data[t],e,!0),r=this.binaryIndices[e].values,i=this.calculateRange("$eq",e,n);if(0===i[0]&&-1===i[1])return null;for(var s=i[1],a=i[0];a<=s;a++)if(r[a]===t)return a;return null},S.prototype.adaptiveBinaryIndexInsert=function(t,e){var n=-1!==e.indexOf("."),r=this.binaryIndices[e].values,i=o.getIn(this.data[t],e,n);!0===this.serializableIndices&&i instanceof Date&&(this.data[t][e]=i.getTime(),i=o.getIn(this.data[t],e));var s=0===r.length?0:this.calculateRangeStart(e,i,!0,n);this.binaryIndices[e].values.splice(s,0,t)},S.prototype.adaptiveBinaryIndexUpdate=function(t,e){var n,r=this.binaryIndices[e].values,i=r.length;for(n=0;n<i&&r[n]!==t;n++);this.binaryIndices[e].values.splice(n,1),this.adaptiveBinaryIndexInsert(t,e)},S.prototype.adaptiveBinaryIndexRemove=function(t,e,n){var r,i,o,s,a,u,l,c=this.binaryIndices[e],h={};if(Array.isArray(t)){if(1!==(s=t.length)){for(o=0;o<s;o++)h[t[o]]=!0;if(c.values=c.values.filter(function(t){return!h[t]}),!0===n)return;var f=t.slice();for(f.sort(function(t,e){return t-e}),r=c.values.length,i=0;i<r;i++){for(a=c.values[i],u=0,o=0;o<s&&a>f[o];o++)u++;c.values[i]-=u}return}t=t[0]}if(null===(l=this.getBinaryIndexPosition(t,e)))return null;if(c.values.splice(l,1),!0!==n)for(r=c.values.length,i=0;i<r;i++)c.values[i]>t&&c.values[i]--},S.prototype.calculateRangeStart=function(t,e,n,r){var i=this.data,a=this.binaryIndices[t].values,u=0,l=a.length-1,c=0;if(0===a.length)return-1;for(o.getIn(i[a[u]],t,r),o.getIn(i[a[l]],t,r);u<l;)s.lt(o.getIn(i[a[c=u+l>>1]],t,r),e,!1)?u=c+1:l=c;var h=u;return s.aeq(e,o.getIn(i[a[h]],t,r))?h:s.lt(e,o.getIn(i[a[h]],t,r),!1)?n?h:h-1:n?h+1:h},S.prototype.calculateRangeEnd=function(t,e,n){var r=this.data,i=this.binaryIndices[t].values,a=0,u=i.length-1,l=0;if(0===i.length)return-1;for(o.getIn(r[i[a]],t,n),o.getIn(r[i[u]],t,n);a<u;)s.lt(e,o.getIn(r[i[l=a+u>>1]],t,n),!1)?u=l:a=l+1;var c=u;return s.aeq(e,o.getIn(r[i[c]],t,n))?c:s.gt(e,o.getIn(r[i[c]],t,n),!1)?c+1:s.aeq(e,o.getIn(r[i[c-1]],t,n))?c-1:c},S.prototype.calculateRange=function(t,e,n){var r,i,a,u=this.data,l=this.binaryIndices[e].values,c=l.length-1;if(0===u.length)return[0,-1];var h=-1!==e.indexOf("."),f=o.getIn(u[l[0]],e,h),d=o.getIn(u[l[c]],e,h);switch(t){case"$eq":case"$aeq":case"$dteq":if(s.lt(n,f,!1)||s.gt(n,d,!1))return[0,-1];break;case"$gt":if(s.gt(n,d,!0))return[0,-1];if(s.gt(f,n,!1))return[0,c];break;case"$gte":if(s.gt(n,d,!1))return[0,-1];if(s.gt(f,n,!0))return[0,c];break;case"$lt":if(s.lt(n,f,!0))return[0,-1];if(s.lt(d,n,!1))return[0,c];break;case"$lte":if(s.lt(n,f,!1))return[0,-1];if(s.lt(d,n,!0))return[0,c];break;case"$between":return s.gt(n[0],d,!1)||s.lt(n[1],f,!1)?[0,-1]:((r=this.calculateRangeStart(e,n[0],!1,h))<0&&r++,(a=this.calculateRangeEnd(e,n[1],h))>c&&a--,s.gt(o.getIn(u[l[r]],e,h),n[0],!0)||r++,s.lt(o.getIn(u[l[a]],e,h),n[1],!0)||a--,a<r?[0,-1]:[r,a]);case"$in":for(var p=[],y=[],v=0,m=n.length;v<m;v++)for(var g=this.calculateRange("$eq",e,n[v]),b=g[0];b<=g[1];b++)void 0===p[b]&&(p[b]=!0,y.push(b));return y}switch(t){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":r=this.calculateRangeStart(e,n,!1,h),i=o.getIn(u[l[r]],e,h)}switch(t){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":a=this.calculateRangeEnd(e,n,h),o.getIn(u[l[a]],e,h)}switch(t){case"$eq":case"$aeq":case"$dteq":return s.aeq(i,n)?[r,a]:[0,-1];case"$gt":return s.aeq(o.getIn(u[l[a]],e,h),n)?[a+1,c]:[a,c];case"$gte":return s.aeq(o.getIn(u[l[r]],e,h),n)?[r,c]:[r+1,c];case"$lt":return s.aeq(o.getIn(u[l[r]],e,h),n)?[0,r-1]:[0,r];case"$lte":return s.aeq(o.getIn(u[l[a]],e,h),n)?[0,a]:[0,a-1];default:return[0,u.length-1]}},S.prototype.by=function(t,e){var n;if(void 0===e)return n=this,function(e){return n.by(t,e)};var r=this.getUniqueIndex(t,!0).get(e);return this.cloneObjects?v(r,this.cloneMethod):r},S.prototype.findOne=function(t){t=t||{};var e=this.chain().find(t,!0).data();return Array.isArray(e)&&0===e.length?null:this.cloneObjects?v(e[0],this.cloneMethod):e[0]},S.prototype.chain=function(t,e){var n=new O(this);return void 0===t?n:n.transform(t,e)},S.prototype.find=function(t){return this.chain().find(t).data()},S.prototype.findOneUnindexed=function(t,e){for(var n=this.data.length;n--;)if(o.getIn(this.data[n],t,!0)===e)return this.data[n];return null},S.prototype.startTransaction=function(){if(this.transactional){this.cachedData=v(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices,this.cachedDirtyIds=this.dirtyIds;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].startTransaction()}},S.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedDirtyIds=null;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].commit()}},S.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex,this.dirtyIds=this.cachedDirtyIds);for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].rollback()}},S.prototype.async=function(t,e){setTimeout(function(){if("function"!=typeof t)throw new TypeError("Argument passed for async execution is not a function");t(),e()},0)},S.prototype.where=function(t){return this.chain().where(t).data()},S.prototype.mapReduce=function(t,e){try{return e(this.data.map(t))}catch(n){throw n}},S.prototype.eqJoin=function(t,e,n,r,i){return new O(this).eqJoin(t,e,n,r,i)},S.prototype.stages={},S.prototype.getStage=function(t){return this.stages[t]||(this.stages[t]={}),this.stages[t]},S.prototype.commitLog=[],S.prototype.stage=function(t,e){var n=JSON.parse(JSON.stringify(e));return this.getStage(t)[e.$loki]=n,n},S.prototype.commitStage=function(t,e){var n,r=this.getStage(t),i=(new Date).getTime();for(n in r)this.update(r[n]),this.commitLog.push({timestamp:i,message:e,data:JSON.parse(JSON.stringify(r[n]))});this.stages[t]={}},S.prototype.no_op=function(){},S.prototype.extract=function(t){for(var e=0,n=this.data.length,r=D(t),i=[];e<n;e+=1)i.push(F(this.data[e],t,r));return i},S.prototype.max=function(t){return Math.max.apply(null,this.extract(t))},S.prototype.min=function(t){return Math.min.apply(null,this.extract(t))},S.prototype.maxRecord=function(t){for(var e,n=0,r=this.data.length,i=D(t),o={index:0,value:void 0};n<r;n+=1)void 0!==e?e<F(this.data[n],t,i)&&(e=F(this.data[n],t,i),o.index=this.data[n].$loki):(e=F(this.data[n],t,i),o.index=this.data[n].$loki);return o.value=e,o},S.prototype.minRecord=function(t){for(var e,n=0,r=this.data.length,i=D(t),o={index:0,value:void 0};n<r;n+=1)void 0!==e?e>F(this.data[n],t,i)&&(e=F(this.data[n],t,i),o.index=this.data[n].$loki):(e=F(this.data[n],t,i),o.index=this.data[n].$loki);return o.value=e,o},S.prototype.extractNumerical=function(t){return this.extract(t).map(A).filter(Number).filter(function(t){return!isNaN(t)})},S.prototype.avg=function(t){return E(this.extractNumerical(t))},S.prototype.stdDev=function(t){return e=this.extractNumerical(t),n=E(e),r=E(e.map(function(t){var e=t-n;return e*e})),Math.sqrt(r);var e,n,r},S.prototype.mode=function(t){var e,n,r,i={},o=this.extract(t);for(n in o.forEach(function(t){i[t]?i[t]+=1:i[t]=1}),i)e?e<i[n]&&(r=n):(r=n,e=i[n]);return r},S.prototype.median=function(t){var e=this.extractNumerical(t);e.sort(j);var n=Math.floor(e.length/2);return e.length%2?e[n]:(e[n-1]+e[n])/2},q.prototype={keys:[],values:[],sort:function(t,e){return t<e?-1:t>e?1:0},setSort:function(t){this.bs=new B(t)},bs:function(){return new B(this.sort)},set:function(t,e){var n=this.bs(this.keys,t);n.found?this.values[n.index]=e:(this.keys.splice(n.index,0,t),this.values.splice(n.index,0,e))},get:function(t){return this.values[M(this.keys,t,this.sort).index]}},N.prototype.keyMap={},N.prototype.lokiMap={},N.prototype.set=function(t){var e=t[this.field];if(null!=e){if(this.keyMap[e])throw new Error("Duplicate key for property "+this.field+": "+e);this.keyMap[e]=t,this.lokiMap[t.$loki]=e}},N.prototype.get=function(t){return this.keyMap[t]},N.prototype.byId=function(t){return this.keyMap[this.lokiMap[t]]},N.prototype.update=function(t,e){if(this.lokiMap[t.$loki]!==e[this.field]){var n=this.lokiMap[t.$loki];this.set(e),this.keyMap[n]=void 0}else this.keyMap[t[this.field]]=e},N.prototype.remove=function(t){var e=this.keyMap[t];if(null==e)throw new Error("Key is not in unique index: "+this.field);this.keyMap[t]=void 0,this.lokiMap[e.$loki]=void 0},N.prototype.clear=function(){this.keyMap=Object.create(null),this.lokiMap=Object.create(null)},K.prototype={set:function(t,e){this.index[t]?this.index[t].push(e):this.index[t]=[e]},remove:function(t,e){var n=this.index[t];for(var r in n)n[r]==e&&n.splice(r,1);n.length<1&&(this.index[t]=void 0)},get:function(t){return this.index[t]},clear:function(t){this.index={}}},b.deepFreeze=e,b.freeze=r,b.unFreeze=i,b.LokiOps=p,b.Collection=S,b.DynamicView=P,b.Resultset=O,b.KeyValueStore=q,b.LokiMemoryAdapter=w,b.LokiPartitioningAdapter=I,b.LokiLocalStorageAdapter=k,b.LokiFsAdapter=x,b.persistenceAdapters={fs:x,localStorage:k},b.aeq=a,b.lt=u,b.gt=l,b.Comparators=s,b}()})?r.apply(e,[]):r)||(t.exports=i)},pnzC:function(t,e,n){var r,i;void 0===(i="function"==typeof(r=function(){return function(){function t(t,e){if(this.app="loki",this.options=e||{},void 0!==t&&(this.app=t),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function e(t){this.db=null,this.initializeLokiCatalog(t)}return t.prototype.closeDatabase=function(){this.catalog&&this.catalog.db&&(this.catalog.db.close(),this.catalog.db=null)},t.prototype.checkAvailability=function(){return!("undefined"==typeof indexedDB||!indexedDB)},t.prototype.loadKey=t.prototype.loadDatabase=function(t,n){var r=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(this.app,t,function(t){if("function"==typeof n){if(0===t.id)return void n(null);n(t.val)}else console.log(t.val)}):this.catalog=new e(function(e){r.catalog=e,r.loadDatabase(t,n)})},t.prototype.saveKey=t.prototype.saveDatabase=function(t,n,r){var i=this;function o(t){r(t&&!0===t.success?null:new Error("Error saving database")),i.options.closeAfterSave&&i.closeDatabase()}null!==this.catalog&&null!==this.catalog.db?this.catalog.setAppKey(this.app,t,n,o):this.catalog=new e(function(e){i.saveDatabase(t,n,o)})},t.prototype.deleteKey=t.prototype.deleteDatabase=function(t,n){var r=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(this.app,t,function(t){var e=t.id;0!==e?r.catalog.deleteAppKey(e,n):"function"==typeof n&&n({success:!0})}):this.catalog=new e(function(e){r.catalog=e,r.deleteDatabase(t,n)})},t.prototype.deleteDatabasePartitions=function(t){var e=this;this.getDatabaseList(function(n){n.forEach(function(n){n.startsWith(t)&&e.deleteDatabase(n)})})},t.prototype.getKeyList=t.prototype.getDatabaseList=function(t){var n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKeys(this.app,function(e){for(var n=[],r=0;r<e.length;r++)n.push(e[r].key);"function"==typeof t?t(n):n.forEach(function(t){console.log(t)})}):this.catalog=new e(function(e){n.catalog=e,n.getDatabaseList(t)})},t.prototype.getCatalogSummary=function(t){var n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAllKeys(function(e){for(var n,r=[],i=0;i<e.length;i++)r.push({app:(n=e[i]).app,key:n.key,size:2*(n.app||"").length+2*(n.key||"").length+(n.val||"").length+1});"function"==typeof t?t(r):r.forEach(function(t){console.log(t)})}):this.catalog=new e(function(e){n.catalog=e,n.getCatalogSummary(t)})},e.prototype.initializeLokiCatalog=function(t){var e=indexedDB.open("LokiCatalog",1),n=this;e.onupgradeneeded=function(t){var e=t.target.result;if(e.objectStoreNames.contains("LokiAKV")&&e.deleteObjectStore("LokiAKV"),!e.objectStoreNames.contains("LokiAKV")){var n=e.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0});n.createIndex("app","app",{unique:!1}),n.createIndex("key","key",{unique:!1}),n.createIndex("appkey","appkey",{unique:!0})}},e.onsuccess=function(e){n.db=e.target.result,"function"==typeof t&&t(n)},e.onerror=function(t){throw t}},e.prototype.getAppKey=function(t,e,n){var r,i=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("appkey").get(t+","+e);i.onsuccess=(r=n,function(t){var e=t.target.result;null==e&&(e={id:0,success:!1}),"function"==typeof r?r(e):console.log(e)}),i.onerror=function(t){return function(e){if("function"!=typeof t)throw e;t({id:0,success:!1})}}(n)},e.prototype.getAppKeyById=function(t,e,n){this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").get(t).onsuccess=function(t,e){return function(n){"function"==typeof e?e(n.target.result,t):console.log(n.target.result)}}(n,e)},e.prototype.setAppKey=function(t,e,n,r){var i,o=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV"),s=o.index("appkey").get(t+","+e);s.onsuccess=function(i){var a=i.target.result;null==a?a={app:t,key:e,appkey:t+","+e,val:n}:a.val=n;var u,l=o.put(a);l.onerror=(u=r,function(t){"function"==typeof u?u({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(s.error))}),l.onsuccess=function(t){return function(e){"function"==typeof t&&t({success:!0})}}(r)},s.onerror=(i=r,function(t){"function"==typeof i?i({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(s.error))})},e.prototype.deleteAppKey=function(t,e){var n,r=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV").delete(t);r.onsuccess=(n=e,function(t){"function"==typeof n&&n({success:!0})}),r.onerror=function(t){return function(e){"function"==typeof t?t({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(r.error))}}(e)},e.prototype.getAppKeys=function(t,e){var n,r=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("app"),i=IDBKeyRange.only(t),o=r.openCursor(i);o.onsuccess=function(t,e){return function(n){var r=n.target.result;r?(t.push(r.value),r.continue()):"function"==typeof e?e(t):console.log(t)}}([],e),o.onerror=(n=e,function(t){"function"==typeof n?n(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(t))})},e.prototype.getAllKeys=function(t){var e,n=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").openCursor();n.onsuccess=function(t,e){return function(n){var r=n.target.result;r?(t.push(r.value),r.continue()):"function"==typeof e?e(t):console.log(t)}}([],t),n.onerror=(e=t,function(t){"function"==typeof e&&e(null)})},t}()})?r.apply(e,[]):r)||(t.exports=i)}});